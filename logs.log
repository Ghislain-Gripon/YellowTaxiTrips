29/06/2021 17:37:46,174 - INFO - [FolderStructure.py:30] - Loaded logger yaml configuration at config/logger_config.yaml
29/06/2021 17:37:46,175 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on config/flows.yaml
29/06/2021 17:37:46,175 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:37:46,176 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:46,176 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:37:46,176 - DEBUG - [FolderStructure.py:99] - FolderStructure.load starting on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:37:46,176 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:37:46,176 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:46,176 - INFO - [FolderStructure.py:106] - Reading C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml, forwarding python yaml dict.
29/06/2021 17:37:46,177 - DEBUG - [FolderStructure.py:115] - FolderStructure.read starting with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml arguments.
29/06/2021 17:37:46,186 - INFO - [FolderStructure.py:121] - YAML configuration file successfully read.
29/06/2021 17:37:46,186 - DEBUG - [FolderStructure.py:134] - FolderStructure.read ended with <FolderStructure.FolderStructure object at 0x033F4688>, {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]} arguments.
29/06/2021 17:37:46,186 - DEBUG - [FolderStructure.py:110] - FolderStructure.load ended with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml, {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]}
29/06/2021 17:37:46,187 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound loaded.
29/06/2021 17:37:46,187 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work loaded.
29/06/2021 17:37:46,187 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\error loaded.
29/06/2021 17:37:46,187 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done loaded.
29/06/2021 17:37:46,187 - INFO - [FolderStructure.py:43] - File directories set up.
29/06/2021 17:37:46,188 - DEBUG - [FolderStructure.py:138] - FolderStructure.get_config run for config configuration type.
29/06/2021 17:37:46,188 - DEBUG - [FolderStructure.py:146] - config type config returned {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}
29/06/2021 17:37:46,188 - DEBUG - [FolderStructure.py:138] - FolderStructure.get_config run for flows configuration type.
29/06/2021 17:37:46,188 - DEBUG - [FolderStructure.py:146] - flows type config returned {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]}
29/06/2021 17:37:46,188 - DEBUG - [Workflow.py:28] - Running flows from flow file.
29/06/2021 17:37:46,188 - DEBUG - [Workflow.py:168] - Workflow.get_connection with <Workflow.Workflow object at 0x01C2AF10> arguments.
29/06/2021 17:37:46,188 - DEBUG - [Workflow.py:161] - Workflow.request_info starting.
29/06/2021 17:37:58,27 - DEBUG - [Workflow.py:164] - Workflow.request_info with username : postgres
29/06/2021 17:37:58,42 - DEBUG - [Workflow.py:176] - Fetching database handling class at PostgreDBServer.PostgreDBServer using the configuration.
29/06/2021 17:37:58,42 - DEBUG - [PostgreDBServer.py:10] - __init__ starting with {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}, postgres and user inputed password arguments.
29/06/2021 17:37:58,98 - INFO - [PostgreDBServer.py:22] - Established connection with the database of PostgreDBServer type with autocommit.
29/06/2021 17:37:58,99 - DEBUG - [PostgreDBServer.py:29] - __init__ ended with <connection object at 0x033F9320; dsn: 'user=postgres password=xxx dbname=YellowTaxiTrips host=localhost port=5432', closed: 0> connection object, postgres user and config {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}
29/06/2021 17:37:58,99 - DEBUG - [Workflow.py:190] - Workflow.get_connection ended with [<Workflow.Workflow object at 0x01C2AF10>, <PostgreDBServer.PostgreDBServer object at 0x0120E808>] return variables.
29/06/2021 17:37:58,100 - DEBUG - [PostgreDBServer.py:158] - Sarting PostgreDBServer.get_now with <PostgreDBServer.PostgreDBServer object at 0x0120E808> instance.
29/06/2021 17:37:58,100 - INFO - [PostgreDBServer.py:162] - Fetching current time from database.
29/06/2021 17:37:58,102 - INFO - [PostgreDBServer.py:167] - Current time is 2021-06-29 17:37:58
29/06/2021 17:37:58,102 - DEBUG - [PostgreDBServer.py:187] - Ending get_now with 2021-06-29 17:37:58 as current database time.
29/06/2021 17:37:58,102 - INFO - [Workflow.py:33] - Iterating over flows.
29/06/2021 17:37:58,102 - INFO - [Workflow.py:35] - Running raw_vault_and_infomart_schema_creation flow.
29/06/2021 17:37:58,102 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:37:58,102 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/create_raw_vault_structure.sql
29/06/2021 17:37:58,102 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql
29/06/2021 17:37:58,103 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,103 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql
29/06/2021 17:37:58,103 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
-- DROP SCHEMA raw_vault;

CREATE SCHEMA IF NOT EXISTS raw_vault;
-- Drop table

-- DROP TABLE raw_vault.hubpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.hubpaymenttypes (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubpaymenttypes_un UNIQUE (paymenttypehashkey)
);


-- raw_vault.hubratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.hubratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.hubratecodeids (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubratecodeids_un UNIQUE (ratecodenamehashkey)
);


-- raw_vault.hubtrips definition

-- Drop table

-- DROP TABLE raw_vault.hubtrips;

CREATE TABLE IF NOT EXISTS raw_vault.hubtrips (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	vendorid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT hubtrips_un UNIQUE (triphashkey)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_pickup_datetime);


-- raw_vault.hubvendors definition

-- Drop table

-- DROP TABLE raw_vault.hubvendors;

CREATE TABLE IF NOT EXISTS raw_vault.hubvendors (
	vendorhashkey CHAR(64) NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubvendors_csv_un UNIQUE (vendorhashkey)
);


-- raw_vault.hubzones definition

-- Drop table

-- DROP TABLE raw_vault.hubzones;

CREATE TABLE IF NOT EXISTS raw_vault.hubzones (
	zonenamehashkey CHAR(64) NOT NULL,
	"zone" varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	borough varchar NULL,
	service_zone varchar NULL,
	CONSTRAINT hublocation_un UNIQUE (zonenamehashkey)
);


-- raw_vault.rawpaymenttypesfile definition

-- Drop table

-- DROP TABLE raw_vault.rawpaymenttypesfile;




-- raw_vault.satpaymenttypes definition

-- Drop table

-- DROP TABLE raw_vault.satpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.satpaymenttypes_csv (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypeid int4 NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satpaymenttypes_csv_un UNIQUE (paymenttypehashkey, loaddate)
);


-- raw_vault.satratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.satratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.satratecodeids_csv (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodeid int4 NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satratecodeids_csv_un UNIQUE (ratecodenamehashkey, loaddate)
);


-- raw_vault.sattrips definition

-- Drop table

-- DROP TABLE raw_vault.sattrips;

CREATE TABLE IF NOT EXISTS raw_vault.sattrips_csv (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	passenger_count int4 NULL,
	loadenddate timestamp(0) NOT NULL,
	trip_distance float8 NULL,
	ratecodeid int4 NULL,
	store_and_fwd_flag varchar NULL,
	payment_type int4 NULL,
	fare_amount float8 NULL,
	extra float8 NULL,
	mta_tax float8 NULL,
	improvement_surcharge float8 NULL,
	tip_amount float8 NULL,
	tolls_amount float8 NULL,
	total_amount float8 NOT NULL,
	vendorid int4 NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT sattrips_csv_un UNIQUE (triphashkey, loaddate)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_pickup_datetime);


-- raw_vault.satvendors definition

-- Drop table

-- DROP TABLE raw_vault.satvendors;

CREATE TABLE IF NOT EXISTS raw_vault.satvendors_csv (
	vendorhashkey CHAR(64) NULL,
	vendorid int4 NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	loadenddate timestamp(0) NULL,
	CONSTRAINT satvendors_csv_un UNIQUE (vendorhashkey, loaddate)
);


-- raw_vault.satzones definition

-- Drop table

-- DROP TABLE raw_vault.satzones;

CREATE TABLE IF NOT EXISTS raw_vault.satzones_csv (
	zonenamehashkey CHAR(64) NOT NULL,
	borough varchar NOT NULL,
	"zone" varchar NOT NULL,
	service_zone varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	loadenddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	zoneid int4 NOT NULL,
	CONSTRAINT satzones_csv_un UNIQUE (zonenamehashkey, loaddate)
);


-- raw_vault.linktrips definition

-- Drop table

-- DROP TABLE raw_vault.linktrips

CREATE TABLE IF NOT EXISTS raw_vault.linktrips(
	linktriphashkey CHAR(64) NOT NULL,
	triphashkey CHAR(64) NOT NULL,
	puzonenamehashkey CHAR(64) NOT NULL,
	dozonenamehashkey CHAR(64) NOT NULL,
	vendorhashkey CHAR(64) NOT NULL,
	ratecodenamehashkey CHAR(64) NOT NULL,
	paymenttypehashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	CONSTRAINT linktrip_un UNIQUE (linktriphashkey)
);
 arguments.
29/06/2021 17:37:58,191 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,192 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
-- DROP SCHEMA raw_vault;

CREATE SCHEMA IF NOT EXISTS raw_vault;
-- Drop table

-- DROP TABLE raw_vault.hubpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.hubpaymenttypes (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubpaymenttypes_un UNIQUE (paymenttypehashkey)
);


-- raw_vault.hubratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.hubratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.hubratecodeids (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubratecodeids_un UNIQUE (ratecodenamehashkey)
);


-- raw_vault.hubtrips definition

-- Drop table

-- DROP TABLE raw_vault.hubtrips;

CREATE TABLE IF NOT EXISTS raw_vault.hubtrips (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	vendorid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT hubtrips_un UNIQUE (triphashkey)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_pickup_datetime);


-- raw_vault.hubvendors definition

-- Drop table

-- DROP TABLE raw_vault.hubvendors;

CREATE TABLE IF NOT EXISTS raw_vault.hubvendors (
	vendorhashkey CHAR(64) NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubvendors_csv_un UNIQUE (vendorhashkey)
);


-- raw_vault.hubzones definition

-- Drop table

-- DROP TABLE raw_vault.hubzones;

CREATE TABLE IF NOT EXISTS raw_vault.hubzones (
	zonenamehashkey CHAR(64) NOT NULL,
	"zone" varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	borough varchar NULL,
	service_zone varchar NULL,
	CONSTRAINT hublocation_un UNIQUE (zonenamehashkey)
);


-- raw_vault.rawpaymenttypesfile definition

-- Drop table

-- DROP TABLE raw_vault.rawpaymenttypesfile;




-- raw_vault.satpaymenttypes definition

-- Drop table

-- DROP TABLE raw_vault.satpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.satpaymenttypes_csv (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypeid int4 NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satpaymenttypes_csv_un UNIQUE (paymenttypehashkey, loaddate)
);


-- raw_vault.satratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.satratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.satratecodeids_csv (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodeid int4 NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satratecodeids_csv_un UNIQUE (ratecodenamehashkey, loaddate)
);


-- raw_vault.sattrips definition

-- Drop table

-- DROP TABLE raw_vault.sattrips;

CREATE TABLE IF NOT EXISTS raw_vault.sattrips_csv (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	passenger_count int4 NULL,
	loadenddate timestamp(0) NOT NULL,
	trip_distance float8 NULL,
	ratecodeid int4 NULL,
	store_and_fwd_flag varchar NULL,
	payment_type int4 NULL,
	fare_amount float8 NULL,
	extra float8 NULL,
	mta_tax float8 NULL,
	improvement_surcharge float8 NULL,
	tip_amount float8 NULL,
	tolls_amount float8 NULL,
	total_amount float8 NOT NULL,
	vendorid int4 NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT sattrips_csv_un UNIQUE (triphashkey, loaddate)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_pickup_datetime);


-- raw_vault.satvendors definition

-- Drop table

-- DROP TABLE raw_vault.satvendors;

CREATE TABLE IF NOT EXISTS raw_vault.satvendors_csv (
	vendorhashkey CHAR(64) NULL,
	vendorid int4 NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	loadenddate timestamp(0) NULL,
	CONSTRAINT satvendors_csv_un UNIQUE (vendorhashkey, loaddate)
);


-- raw_vault.satzones definition

-- Drop table

-- DROP TABLE raw_vault.satzones;

CREATE TABLE IF NOT EXISTS raw_vault.satzones_csv (
	zonenamehashkey CHAR(64) NOT NULL,
	borough varchar NOT NULL,
	"zone" varchar NOT NULL,
	service_zone varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	loadenddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	zoneid int4 NOT NULL,
	CONSTRAINT satzones_csv_un UNIQUE (zonenamehashkey, loaddate)
);


-- raw_vault.linktrips definition

-- Drop table

-- DROP TABLE raw_vault.linktrips

CREATE TABLE IF NOT EXISTS raw_vault.linktrips(
	linktriphashkey CHAR(64) NOT NULL,
	triphashkey CHAR(64) NOT NULL,
	puzonenamehashkey CHAR(64) NOT NULL,
	dozonenamehashkey CHAR(64) NOT NULL,
	vendorhashkey CHAR(64) NOT NULL,
	ratecodenamehashkey CHAR(64) NOT NULL,
	paymenttypehashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	CONSTRAINT linktrip_un UNIQUE (linktriphashkey)
);
 arguments.
29/06/2021 17:37:58,192 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql script on database.
29/06/2021 17:37:58,193 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_schema_creation.sql
29/06/2021 17:37:58,193 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql
29/06/2021 17:37:58,193 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,193 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql
29/06/2021 17:37:58,193 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DROP SCHEMA IF EXISTS information_mart CASCADE;
CREATE SCHEMA information_mart;
CREATE EXTENSION IF NOT EXISTS pgcrypto; arguments.
29/06/2021 17:37:58,203 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,203 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DROP SCHEMA IF EXISTS information_mart CASCADE;
CREATE SCHEMA information_mart;
CREATE EXTENSION IF NOT EXISTS pgcrypto; arguments.
29/06/2021 17:37:58,203 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql script on database.
29/06/2021 17:37:58,204 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/staging_area_create_schema_structure.sql
29/06/2021 17:37:58,204 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql
29/06/2021 17:37:58,204 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,204 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql
29/06/2021 17:37:58,204 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, CREATE SCHEMA IF NOT EXISTS staging_area;

CREATE TABLE IF NOT EXISTS staging_area.rawpaymenttypesfile_csv (
	paymenttype_id varchar NULL,
	paymenttype_name varchar NULL
);


-- staging_area.rawratecodeidsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawratecodeidsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawratecodeidsfile_csv (
	ratecodeid varchar NULL,
	ratecodename varchar NULL
);


-- staging_area.rawtripsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawtripsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawtripsfile_csv (
	vendorid varchar NULL,
	tpep_pickup_datetime varchar NULL,
	tpep_dropoff_datetime varchar NULL,
	passenger_count varchar NULL,
	trip_distance varchar NULL,
	ratecodeid varchar NULL,
	store_and_fwd_flag varchar NULL,
	puzoneid varchar NULL,
	dozoneid varchar NULL,
	payment_type varchar NULL,
	fare_amount varchar NULL,
	extra varchar NULL,
	mta_tax varchar NULL,
	tip_amount varchar NULL,
	tolls_amount varchar NULL,
	improvement_surcharge varchar NULL,
	total_amount varchar NULL
);


-- staging_area.rawvendorsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawvendorsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawvendorsfile_csv (
	vendorid varchar NULL,
	vendorname varchar NULL
);


-- staging_area.rawzonesfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawzonesfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawzonesfile_csv (
	zoneid varchar NULL,
	borough varchar NULL,
	"zone" varchar NULL,
	service_zone varchar NULL
); arguments.
29/06/2021 17:37:58,223 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,223 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, CREATE SCHEMA IF NOT EXISTS staging_area;

CREATE TABLE IF NOT EXISTS staging_area.rawpaymenttypesfile_csv (
	paymenttype_id varchar NULL,
	paymenttype_name varchar NULL
);


-- staging_area.rawratecodeidsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawratecodeidsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawratecodeidsfile_csv (
	ratecodeid varchar NULL,
	ratecodename varchar NULL
);


-- staging_area.rawtripsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawtripsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawtripsfile_csv (
	vendorid varchar NULL,
	tpep_pickup_datetime varchar NULL,
	tpep_dropoff_datetime varchar NULL,
	passenger_count varchar NULL,
	trip_distance varchar NULL,
	ratecodeid varchar NULL,
	store_and_fwd_flag varchar NULL,
	puzoneid varchar NULL,
	dozoneid varchar NULL,
	payment_type varchar NULL,
	fare_amount varchar NULL,
	extra varchar NULL,
	mta_tax varchar NULL,
	tip_amount varchar NULL,
	tolls_amount varchar NULL,
	improvement_surcharge varchar NULL,
	total_amount varchar NULL
);


-- staging_area.rawvendorsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawvendorsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawvendorsfile_csv (
	vendorid varchar NULL,
	vendorname varchar NULL
);


-- staging_area.rawzonesfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawzonesfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawzonesfile_csv (
	zoneid varchar NULL,
	borough varchar NULL,
	"zone" varchar NULL,
	service_zone varchar NULL
); arguments.
29/06/2021 17:37:58,223 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql script on database.
29/06/2021 17:37:58,223 - INFO - [Workflow.py:35] - Running paymenttypes_to_rv flow.
29/06/2021 17:37:58,224 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:37:58,224 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:37:58,224 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x033F4688>
29/06/2021 17:37:58,224 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:37:58,225 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:37:58,225 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\paymenttypes_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:37:58,225 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,226 - INFO - [FolderStructure.py:57] - Moved paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:37:58,226 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,226 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawpaymenttypesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,228 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawpaymenttypesfile_csv using PostgreDBServer database.
29/06/2021 17:37:58,228 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawpaymenttypesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,228 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:37:58,229 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\paymenttypes_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,229 - INFO - [FolderStructure.py:57] - Moved paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:37:58,230 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\paymenttypes_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,230 - INFO - [Workflow.py:35] - Running ratecodeids_to_rv flow.
29/06/2021 17:37:58,230 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:37:58,230 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:37:58,230 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x033F4688>
29/06/2021 17:37:58,230 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:37:58,231 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:37:58,231 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\ratecodeids_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:37:58,231 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,232 - INFO - [FolderStructure.py:57] - Moved ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:37:58,232 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,232 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawratecodeidsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,234 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawratecodeidsfile_csv using PostgreDBServer database.
29/06/2021 17:37:58,235 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawratecodeidsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,235 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:37:58,235 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\ratecodeids_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,236 - INFO - [FolderStructure.py:57] - Moved ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:37:58,236 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\ratecodeids_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,236 - INFO - [Workflow.py:35] - Running vendors_to_rv flow.
29/06/2021 17:37:58,237 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:37:58,237 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:37:58,237 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x033F4688>
29/06/2021 17:37:58,237 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:37:58,238 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:37:58,238 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\vendors_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:37:58,238 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,239 - INFO - [FolderStructure.py:57] - Moved vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:37:58,239 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,239 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawvendorsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,241 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawvendorsfile_csv using PostgreDBServer database.
29/06/2021 17:37:58,241 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawvendorsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:37:58,241 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:37:58,241 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\vendors_csv-file_08-06-2021_reference.csv
29/06/2021 17:37:58,242 - INFO - [FolderStructure.py:57] - Moved vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:37:58,242 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\vendors_csv-file_08-06-2021_reference.csv.
29/06/2021 17:37:58,242 - INFO - [Workflow.py:35] - Running trips_to_rv flow.
29/06/2021 17:37:58,243 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:37:58,243 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:37:58,243 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x033F4688>
29/06/2021 17:37:58,243 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:37:58,243 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:37:58,244 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml.csv and work arguments.
29/06/2021 17:37:58,244 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv
29/06/2021 17:37:58,244 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:37:58,245 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv.
29/06/2021 17:37:58,245 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawtripsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv arguments.
29/06/2021 17:37:58,253 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv loaded in YellowTaxiTrips. staging_area.rawtripsfile_csv using PostgreDBServer database.
29/06/2021 17:37:58,253 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawtripsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv arguments.
29/06/2021 17:37:58,253 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv and done arguments.
29/06/2021 17:37:58,253 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\trips_csv-file_31-05-2021_preml.csv
29/06/2021 17:37:58,254 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:37:58,255 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\trips_csv-file_31-05-2021_preml.csv.
29/06/2021 17:37:58,255 - INFO - [Workflow.py:35] - Running zones_to_rv flow.
29/06/2021 17:37:58,255 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:37:58,255 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:37:58,255 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x033F4688>
29/06/2021 17:37:58,255 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:37:58,256 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:37:58,256 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\zones_csv-file_31-05-2021_taxizone.csv and work arguments.
29/06/2021 17:37:58,256 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv
29/06/2021 17:37:58,257 - INFO - [FolderStructure.py:57] - Moved zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:37:58,257 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv.
29/06/2021 17:37:58,257 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawzonesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv arguments.
29/06/2021 17:37:58,260 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv loaded in YellowTaxiTrips. staging_area.rawzonesfile_csv using PostgreDBServer database.
29/06/2021 17:37:58,260 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, staging_area.rawzonesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv arguments.
29/06/2021 17:37:58,260 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv and done arguments.
29/06/2021 17:37:58,261 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\zones_csv-file_31-05-2021_taxizone.csv
29/06/2021 17:37:58,261 - INFO - [FolderStructure.py:57] - Moved zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:37:58,262 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\zones_csv-file_31-05-2021_taxizone.csv.
29/06/2021 17:37:58,262 - INFO - [Workflow.py:35] - Running sa_to_rv flow.
29/06/2021 17:37:58,262 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:37:58,262 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_1_hubtrips.sql
29/06/2021 17:37:58,262 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql
29/06/2021 17:37:58,262 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,262 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql
29/06/2021 17:37:58,263 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_hubtrips_index;
		DROP INDEX IF EXISTS tpep_dropoff_hubtrips_index;
		
	END IF;
	
	INSERT INTO raw_vault.hubtrips(
		triphashkey, 
		loaddate, 
		recordsource, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		vendorid, 
		is_payment)
			
	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(
				CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
					TRIM(BOTH FROM rtf.vendorid), 
					CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 
				'sha256') 
			AS CHAR(64)) AS triphashkey,
		loaddaterecord, 
		recordsourceorigin, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(rtf.puzoneid AS INTEGER),
		CAST(rtf.dozoneid AS INTEGER),
		CAST(rtf.vendorid AS INTEGER),
		CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN 1 ELSE 0 END
			
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf
		
	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubtrips r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64)));
		
	CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:37:58,348 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,348 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_hubtrips_index;
		DROP INDEX IF EXISTS tpep_dropoff_hubtrips_index;
		
	END IF;
	
	INSERT INTO raw_vault.hubtrips(
		triphashkey, 
		loaddate, 
		recordsource, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		vendorid, 
		is_payment)
			
	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(
				CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
					TRIM(BOTH FROM rtf.vendorid), 
					CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 
				'sha256') 
			AS CHAR(64)) AS triphashkey,
		loaddaterecord, 
		recordsourceorigin, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(rtf.puzoneid AS INTEGER),
		CAST(rtf.dozoneid AS INTEGER),
		CAST(rtf.vendorid AS INTEGER),
		CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN 1 ELSE 0 END
			
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf
		
	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubtrips r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64)));
		
	CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:37:58,348 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql script on database.
29/06/2021 17:37:58,348 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_2_sattrips.sql
29/06/2021 17:37:58,349 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql
29/06/2021 17:37:58,349 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,349 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql
29/06/2021 17:37:58,349 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_sattrips_csv_index;
		DROP INDEX IF EXISTS tpep_dropoff_sattrips_csv_index;
	
	END IF;

	INSERT INTO raw_vault.sattrips_csv (
		triphashkey, 
		loaddate, 
		recordsource, 
		passenger_count, 
		loadenddate, 
		trip_distance, 
		ratecodeid, 
		store_and_fwd_flag, 
		payment_type, 
		fare_amount, 
		extra, 
		mta_tax, 
		improvement_surcharge, 
		tip_amount, 
		tolls_amount, 
		total_amount, 
		vendorid, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		is_payment)

	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM LOWER(rtf.puzoneid)), TRIM(BOTH FROM LOWER(rtf.dozoneid)),
					TRIM(BOTH FROM LOWER(rtf.vendorid)), 
					CAST(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
					ELSE 0 END AS VARCHAR)),
			'sha256') 
		AS CHAR(64)) AS triphashkey,
		loaddaterecord, TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsourceorigin,
		CAST(TRIM(BOTH FROM LOWER(rtf.passenger_count)) AS INTEGER) AS passenger_count, 
		loadenddaterecord,
		CAST(TRIM(BOTH FROM LOWER(rtf.trip_distance)) AS DOUBLE PRECISION) AS trip_distance, 
		CAST(TRIM(BOTH FROM LOWER(rtf.ratecodeid)) AS INTEGER) AS ratecodeid, 
		TRIM(BOTH FROM LOWER(rtf.store_and_fwd_flag)) AS store_and_fwd_flag, 
		CAST(TRIM(BOTH FROM LOWER(rtf.payment_type)) AS INTEGER) AS payment_type,
		CAST(TRIM(BOTH FROM LOWER(rtf.fare_amount)) AS DOUBLE PRECISION) AS fare_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.extra)) AS DOUBLE PRECISION) AS extra,
		CAST(TRIM(BOTH FROM LOWER(rtf.mta_tax)) AS DOUBLE PRECISION) AS mta_tax, 
		CAST(TRIM(BOTH FROM LOWER(rtf.improvement_surcharge)) AS DOUBLE PRECISION) AS improvement_surcharge,
		CAST(TRIM(BOTH FROM LOWER(rtf.tip_amount)) AS DOUBLE PRECISION) AS tip_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.tolls_amount)) AS DOUBLE PRECISION) AS tolls_amount, 
		CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) AS total_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.vendorid)) AS INTEGER) AS vendorid, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime,
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(TRIM(BOTH FROM LOWER(rtf.puzoneid)) AS INTEGER) AS puzoneid, 
		CAST(TRIM(BOTH FROM LOWER(rtf.dozoneid)) AS INTEGER) AS dozoneid,
		(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
			ELSE 0 END) AS is_payment
	
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf

	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.sattrips_csv r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64))
			AND r.loaddate = loaddaterecord);

	CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:37:58,449 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,450 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_sattrips_csv_index;
		DROP INDEX IF EXISTS tpep_dropoff_sattrips_csv_index;
	
	END IF;

	INSERT INTO raw_vault.sattrips_csv (
		triphashkey, 
		loaddate, 
		recordsource, 
		passenger_count, 
		loadenddate, 
		trip_distance, 
		ratecodeid, 
		store_and_fwd_flag, 
		payment_type, 
		fare_amount, 
		extra, 
		mta_tax, 
		improvement_surcharge, 
		tip_amount, 
		tolls_amount, 
		total_amount, 
		vendorid, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		is_payment)

	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM LOWER(rtf.puzoneid)), TRIM(BOTH FROM LOWER(rtf.dozoneid)),
					TRIM(BOTH FROM LOWER(rtf.vendorid)), 
					CAST(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
					ELSE 0 END AS VARCHAR)),
			'sha256') 
		AS CHAR(64)) AS triphashkey,
		loaddaterecord, TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsourceorigin,
		CAST(TRIM(BOTH FROM LOWER(rtf.passenger_count)) AS INTEGER) AS passenger_count, 
		loadenddaterecord,
		CAST(TRIM(BOTH FROM LOWER(rtf.trip_distance)) AS DOUBLE PRECISION) AS trip_distance, 
		CAST(TRIM(BOTH FROM LOWER(rtf.ratecodeid)) AS INTEGER) AS ratecodeid, 
		TRIM(BOTH FROM LOWER(rtf.store_and_fwd_flag)) AS store_and_fwd_flag, 
		CAST(TRIM(BOTH FROM LOWER(rtf.payment_type)) AS INTEGER) AS payment_type,
		CAST(TRIM(BOTH FROM LOWER(rtf.fare_amount)) AS DOUBLE PRECISION) AS fare_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.extra)) AS DOUBLE PRECISION) AS extra,
		CAST(TRIM(BOTH FROM LOWER(rtf.mta_tax)) AS DOUBLE PRECISION) AS mta_tax, 
		CAST(TRIM(BOTH FROM LOWER(rtf.improvement_surcharge)) AS DOUBLE PRECISION) AS improvement_surcharge,
		CAST(TRIM(BOTH FROM LOWER(rtf.tip_amount)) AS DOUBLE PRECISION) AS tip_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.tolls_amount)) AS DOUBLE PRECISION) AS tolls_amount, 
		CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) AS total_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.vendorid)) AS INTEGER) AS vendorid, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime,
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(TRIM(BOTH FROM LOWER(rtf.puzoneid)) AS INTEGER) AS puzoneid, 
		CAST(TRIM(BOTH FROM LOWER(rtf.dozoneid)) AS INTEGER) AS dozoneid,
		(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
			ELSE 0 END) AS is_payment
	
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf

	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.sattrips_csv r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64))
			AND r.loaddate = loaddaterecord);

	CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:37:58,451 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql script on database.
29/06/2021 17:37:58,452 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_3_update_sattrips.sql
29/06/2021 17:37:58,452 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql
29/06/2021 17:37:58,453 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,453 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql
29/06/2021 17:37:58,453 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
									
	UPDATE raw_vault.sattrips_csv st 
	SET loadenddate = loaddaterecord - INTERVAL '1s' 
	WHERE 
		st.loadenddate > loaddaterecord AND 
		st.loaddate < loaddaterecord AND 
		st.triphashkey IN (SELECT triphashkey 
								FROM raw_vault.sattrips_csv 
								WHERE
									triphashkey = st.triphashkey AND 
									loaddate = loaddaterecord);

	TRUNCATE staging_area.rawtripsfile_csv;
								
END $$;
 arguments.
29/06/2021 17:37:58,464 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,464 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
									
	UPDATE raw_vault.sattrips_csv st 
	SET loadenddate = loaddaterecord - INTERVAL '1s' 
	WHERE 
		st.loadenddate > loaddaterecord AND 
		st.loaddate < loaddaterecord AND 
		st.triphashkey IN (SELECT triphashkey 
								FROM raw_vault.sattrips_csv 
								WHERE
									triphashkey = st.triphashkey AND 
									loaddate = loaddaterecord);

	TRUNCATE staging_area.rawtripsfile_csv;
								
END $$;
 arguments.
29/06/2021 17:37:58,464 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql script on database.
29/06/2021 17:37:58,465 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_4_hubzones.sql
29/06/2021 17:37:58,465 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql
29/06/2021 17:37:58,466 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,466 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql
29/06/2021 17:37:58,466 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.hubzones (
		zonenamehashkey, 
		"zone", 
		borough, 
		service_zone,
		loaddate, 
		recordsource
		)

	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') 
			AS CHAR(64)) AS zonenamehashkey, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone",
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough,
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone,
		loaddaterecord,
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource 
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf

	WHERE 
		rtf."zone" IS NOT NULL AND
		rtf.borough IS NOT NULL AND
		rtf.service_zone IS NOT NULL AND
		NOT EXISTS (SELECT * FROM raw_vault.hubzones h WHERE h.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")),
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') AS CHAR(64)));

END $$; arguments.
29/06/2021 17:37:58,475 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,476 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.hubzones (
		zonenamehashkey, 
		"zone", 
		borough, 
		service_zone,
		loaddate, 
		recordsource
		)

	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') 
			AS CHAR(64)) AS zonenamehashkey, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone",
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough,
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone,
		loaddaterecord,
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource 
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf

	WHERE 
		rtf."zone" IS NOT NULL AND
		rtf.borough IS NOT NULL AND
		rtf.service_zone IS NOT NULL AND
		NOT EXISTS (SELECT * FROM raw_vault.hubzones h WHERE h.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")),
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') AS CHAR(64)));

END $$; arguments.
29/06/2021 17:37:58,476 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql script on database.
29/06/2021 17:37:58,476 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_5_satzones.sql
29/06/2021 17:37:58,476 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql
29/06/2021 17:37:58,477 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,477 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql
29/06/2021 17:37:58,477 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satzones_csv(
		zonenamehashkey, 
		loaddate, 
		borough, 
		"zone", 
		service_zone, 
		loadenddate, 
		recordsource, 
		zoneid)
		
	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') as CHAR(64)) AS zonenamehashkey, 
		loaddaterecord, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone", 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone, 
		loadenddaterecord, 
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource, 
		CAST(TRIM(BOTH FROM LOWER(rtf.zoneid)) AS INTEGER) AS zoneid
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf
	
	WHERE 
		rtf.zoneid IS NOT NULL AND 
		rtf.borough IS NOT NULL AND 
		rtf."zone" IS NOT NULL AND 
		rtf.service_zone IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satzones_csv s WHERE s.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), 
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256')
			AS CHAR(64))
			AND s.loaddate = loaddaterecord);
	
END $$; arguments.
29/06/2021 17:37:58,486 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,486 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satzones_csv(
		zonenamehashkey, 
		loaddate, 
		borough, 
		"zone", 
		service_zone, 
		loadenddate, 
		recordsource, 
		zoneid)
		
	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') as CHAR(64)) AS zonenamehashkey, 
		loaddaterecord, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone", 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone, 
		loadenddaterecord, 
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource, 
		CAST(TRIM(BOTH FROM LOWER(rtf.zoneid)) AS INTEGER) AS zoneid
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf
	
	WHERE 
		rtf.zoneid IS NOT NULL AND 
		rtf.borough IS NOT NULL AND 
		rtf."zone" IS NOT NULL AND 
		rtf.service_zone IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satzones_csv s WHERE s.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), 
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256')
			AS CHAR(64))
			AND s.loaddate = loaddaterecord);
	
END $$; arguments.
29/06/2021 17:37:58,486 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql script on database.
29/06/2021 17:37:58,487 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_6_update_satzones.sql
29/06/2021 17:37:58,487 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql
29/06/2021 17:37:58,487 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,487 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql
29/06/2021 17:37:58,487 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	UPDATE raw_vault.satzones_csv sl
		SET loadenddate = loaddaterecord - INTERVAL '1s'
		WHERE 
			sl.loadenddate > loaddaterecord AND 
			sl.loaddate < loaddaterecord AND 
			sl.zonenamehashkey IN (SELECT zonenamehashkey 
										FROM raw_vault.satzones_csv 
										WHERE 
											zonenamehashkey = sl.zonenamehashkey AND 
											loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawzonesfile_csv;
									
END $$; arguments.
29/06/2021 17:37:58,492 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,493 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	UPDATE raw_vault.satzones_csv sl
		SET loadenddate = loaddaterecord - INTERVAL '1s'
		WHERE 
			sl.loadenddate > loaddaterecord AND 
			sl.loaddate < loaddaterecord AND 
			sl.zonenamehashkey IN (SELECT zonenamehashkey 
										FROM raw_vault.satzones_csv 
										WHERE 
											zonenamehashkey = sl.zonenamehashkey AND 
											loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawzonesfile_csv;
									
END $$; arguments.
29/06/2021 17:37:58,493 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql script on database.
29/06/2021 17:37:58,493 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:37:58,494 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:37:58,494 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,494 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:37:58,494 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

--

	INSERT INTO raw_vault.hubratecodeids(
		ratecodenamehashkey,
		ratecodename,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
					FROM raw_vault.hubratecodeids hrc 
					WHERE 
						hrc.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)));
						
END $$; arguments.
29/06/2021 17:37:58,495 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,496 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

--

	INSERT INTO raw_vault.hubratecodeids(
		ratecodenamehashkey,
		ratecodename,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
					FROM raw_vault.hubratecodeids hrc 
					WHERE 
						hrc.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)));
						
END $$; arguments.
29/06/2021 17:37:58,496 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql script on database.
29/06/2021 17:37:58,496 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_8_satratecodeids.sql
29/06/2021 17:37:58,497 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql
29/06/2021 17:37:58,497 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,497 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql
29/06/2021 17:37:58,497 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satratecodeids_csv(
		ratecodenamehashkey,
		ratecodeid,
		ratecodename,
		loaddate,
		loadenddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		CAST(rrcf.ratecodeid AS INTEGER),
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satratecodeids_csv src 
						WHERE 
							src.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256')
							AS CHAR(64))
							AND src.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:37:58,500 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,501 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satratecodeids_csv(
		ratecodenamehashkey,
		ratecodeid,
		ratecodename,
		loaddate,
		loadenddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		CAST(rrcf.ratecodeid AS INTEGER),
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satratecodeids_csv src 
						WHERE 
							src.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256')
							AS CHAR(64))
							AND src.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:37:58,501 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql script on database.
29/06/2021 17:37:58,501 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:37:58,502 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:37:58,502 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,502 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:37:58,502 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

	UPDATE raw_vault.satratecodeids_csv src 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		src.loadenddate > loaddaterecord AND 
		src.loaddate < loaddaterecord AND 
		src.ratecodenamehashkey IN (SELECT ratecodenamehashkey 
								FROM raw_vault.satratecodeids_csv 
								WHERE
									ratecodenamehashkey = src.ratecodenamehashkey AND 
									loaddate = loaddaterecord);
								

	
	TRUNCATE staging_area.rawratecodeidsfile_csv;

END $$; arguments.
29/06/2021 17:37:58,507 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,507 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

	UPDATE raw_vault.satratecodeids_csv src 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		src.loadenddate > loaddaterecord AND 
		src.loaddate < loaddaterecord AND 
		src.ratecodenamehashkey IN (SELECT ratecodenamehashkey 
								FROM raw_vault.satratecodeids_csv 
								WHERE
									ratecodenamehashkey = src.ratecodenamehashkey AND 
									loaddate = loaddaterecord);
								

	
	TRUNCATE staging_area.rawratecodeidsfile_csv;

END $$; arguments.
29/06/2021 17:37:58,508 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql script on database.
29/06/2021 17:37:58,508 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:37:58,508 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:37:58,509 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,509 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:37:58,509 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubpaymenttypes(
		paymenttypehashkey,
		paymenttypename,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubpaymenttypes hpt 
						WHERE hpt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
															'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:37:58,510 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,511 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubpaymenttypes(
		paymenttypehashkey,
		paymenttypename,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubpaymenttypes hpt 
						WHERE hpt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
															'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:37:58,511 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql script on database.
29/06/2021 17:37:58,511 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:37:58,512 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:37:58,512 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,512 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:37:58,512 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satpaymenttypes_csv(
		paymenttypehashkey,
		paymenttypeid,
		paymenttypename,
		loaddate,
		loadenddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		CAST(rptf.paymenttype_id AS INTEGER),
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE 
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satpaymenttypes_csv spt 
		WHERE spt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64))
			AND spt.loaddate = loaddaterecord);
			
END $$; arguments.
29/06/2021 17:37:58,514 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,515 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satpaymenttypes_csv(
		paymenttypehashkey,
		paymenttypeid,
		paymenttypename,
		loaddate,
		loadenddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		CAST(rptf.paymenttype_id AS INTEGER),
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE 
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satpaymenttypes_csv spt 
		WHERE spt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64))
			AND spt.loaddate = loaddaterecord);
			
END $$; arguments.
29/06/2021 17:37:58,515 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql script on database.
29/06/2021 17:37:58,516 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:37:58,516 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:37:58,516 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,516 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:37:58,516 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
								
	UPDATE raw_vault.satpaymenttypes_csv spt 
	SET loadenddate = loaddaterecord - INTERVAL '1s'   
	WHERE 
		spt.loadenddate > loaddaterecord AND 
		spt.loaddate < loaddaterecord AND 
		spt.paymenttypehashkey IN (SELECT paymenttypehashkey 
								FROM raw_vault.satpaymenttypes_csv 
								WHERE
									paymenttypehashkey = spt.paymenttypehashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawpaymenttypesfile_csv;

END $$; arguments.
29/06/2021 17:37:58,522 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,523 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
								
	UPDATE raw_vault.satpaymenttypes_csv spt 
	SET loadenddate = loaddaterecord - INTERVAL '1s'   
	WHERE 
		spt.loadenddate > loaddaterecord AND 
		spt.loaddate < loaddaterecord AND 
		spt.paymenttypehashkey IN (SELECT paymenttypehashkey 
								FROM raw_vault.satpaymenttypes_csv 
								WHERE
									paymenttypehashkey = spt.paymenttypehashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawpaymenttypesfile_csv;

END $$; arguments.
29/06/2021 17:37:58,523 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql script on database.
29/06/2021 17:37:58,523 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_13_hubvendors.sql
29/06/2021 17:37:58,523 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql
29/06/2021 17:37:58,524 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,524 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql
29/06/2021 17:37:58,524 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubvendors(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.hubvendors hv 
						WHERE 
							hv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)));
							
END $$; arguments.
29/06/2021 17:37:58,525 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,526 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubvendors(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.hubvendors hv 
						WHERE 
							hv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)));
							
END $$; arguments.
29/06/2021 17:37:58,526 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql script on database.
29/06/2021 17:37:58,526 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_14_satvendors.sql
29/06/2021 17:37:58,526 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql
29/06/2021 17:37:58,527 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,527 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql
29/06/2021 17:37:58,527 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satvendors_csv(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource,
		vendorid,
		loadenddate)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin,
		CAST(rvf.vendorid AS INTEGER),
		loadenddaterecord
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satvendors_csv sv 
						WHERE 
							sv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64))
							AND sv.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:37:58,528 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,529 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satvendors_csv(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource,
		vendorid,
		loadenddate)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin,
		CAST(rvf.vendorid AS INTEGER),
		loadenddaterecord
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satvendors_csv sv 
						WHERE 
							sv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64))
							AND sv.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:37:58,529 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql script on database.
29/06/2021 17:37:58,529 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_15_update_satvendors.sql
29/06/2021 17:37:58,529 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql
29/06/2021 17:37:58,530 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,530 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql
29/06/2021 17:37:58,530 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

								
	UPDATE raw_vault.satvendors_csv sv 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		sv.loadenddate > loaddaterecord AND 
		sv.loaddate < loaddaterecord AND 
		sv.vendorhashkey IN (SELECT vendorhashkey 
								FROM raw_vault.satvendors_csv 
								WHERE
									vendorhashkey = sv.vendorhashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawvendorsfile_csv;
								
END $$; arguments.
29/06/2021 17:37:58,535 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,535 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

								
	UPDATE raw_vault.satvendors_csv sv 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		sv.loadenddate > loaddaterecord AND 
		sv.loaddate < loaddaterecord AND 
		sv.vendorhashkey IN (SELECT vendorhashkey 
								FROM raw_vault.satvendors_csv 
								WHERE
									vendorhashkey = sv.vendorhashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawvendorsfile_csv;
								
END $$; arguments.
29/06/2021 17:37:58,536 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql script on database.
29/06/2021 17:37:58,536 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_16_linktrips.sql
29/06/2021 17:37:58,536 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql
29/06/2021 17:37:58,536 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,536 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql
29/06/2021 17:37:58,537 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('system'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.linktrips(
		linktriphashkey,
		triphashkey,
		puzonenamehashkey,
		dozonenamehashkey,
		vendorhashkey,
		ratecodenamehashkey,
		paymenttypehashkey,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (linktriphashkey)
		CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
			pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
			src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)) AS linktriphashkey,
		st.triphashkey,
		pusz.zonenamehashkey,
		dosz.zonenamehashkey,
		sv.vendorhashkey,
		src.ratecodenamehashkey,
		spt.paymenttypehashkey,
		loaddaterecord, 
		recordsourceorigin
		
	FROM raw_vault.sattrips_csv st
		JOIN raw_vault.satzones_csv pusz ON st.puzoneid = pusz.zoneid AND loaddaterecord < pusz.loadenddate AND loaddaterecord >= pusz.loaddate
		JOIN raw_vault.satzones_csv dosz ON st.dozoneid = dosz.zoneid AND loaddaterecord < dosz.loadenddate AND loaddaterecord >= dosz.loaddate
		JOIN raw_vault.satvendors_csv sv ON st.vendorid = sv.vendorid AND loaddaterecord < sv.loadenddate AND loaddaterecord >= sv.loaddate
		JOIN raw_vault.satratecodeids_csv src ON st.ratecodeid = src.ratecodeid AND loaddaterecord < src.loadenddate AND loaddaterecord >= src.loaddate
		JOIN raw_vault.satpaymenttypes_csv spt ON st.payment_type = spt.paymenttypeid AND loaddaterecord < spt.loadenddate AND loaddaterecord >= spt.loaddate

	WHERE 
		st.triphashkey IS NOT NULL AND
		pusz.zonenamehashkey IS NOT NULL AND 
		dosz.zonenamehashkey IS NOT NULL AND
		sv.vendorhashkey IS NOT NULL AND
		src.ratecodenamehashkey IS NOT NULL AND
		spt.paymenttypehashkey IS NOT NULL AND
		NOT EXISTS (SELECT * 
						FROM raw_vault.linktrips l 
						WHERE 
							l.linktriphashkey = CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
													pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
													src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:37:58,598 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,599 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:37:58' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('system'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.linktrips(
		linktriphashkey,
		triphashkey,
		puzonenamehashkey,
		dozonenamehashkey,
		vendorhashkey,
		ratecodenamehashkey,
		paymenttypehashkey,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (linktriphashkey)
		CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
			pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
			src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)) AS linktriphashkey,
		st.triphashkey,
		pusz.zonenamehashkey,
		dosz.zonenamehashkey,
		sv.vendorhashkey,
		src.ratecodenamehashkey,
		spt.paymenttypehashkey,
		loaddaterecord, 
		recordsourceorigin
		
	FROM raw_vault.sattrips_csv st
		JOIN raw_vault.satzones_csv pusz ON st.puzoneid = pusz.zoneid AND loaddaterecord < pusz.loadenddate AND loaddaterecord >= pusz.loaddate
		JOIN raw_vault.satzones_csv dosz ON st.dozoneid = dosz.zoneid AND loaddaterecord < dosz.loadenddate AND loaddaterecord >= dosz.loaddate
		JOIN raw_vault.satvendors_csv sv ON st.vendorid = sv.vendorid AND loaddaterecord < sv.loadenddate AND loaddaterecord >= sv.loaddate
		JOIN raw_vault.satratecodeids_csv src ON st.ratecodeid = src.ratecodeid AND loaddaterecord < src.loadenddate AND loaddaterecord >= src.loaddate
		JOIN raw_vault.satpaymenttypes_csv spt ON st.payment_type = spt.paymenttypeid AND loaddaterecord < spt.loadenddate AND loaddaterecord >= spt.loaddate

	WHERE 
		st.triphashkey IS NOT NULL AND
		pusz.zonenamehashkey IS NOT NULL AND 
		dosz.zonenamehashkey IS NOT NULL AND
		sv.vendorhashkey IS NOT NULL AND
		src.ratecodenamehashkey IS NOT NULL AND
		spt.paymenttypehashkey IS NOT NULL AND
		NOT EXISTS (SELECT * 
						FROM raw_vault.linktrips l 
						WHERE 
							l.linktriphashkey = CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
													pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
													src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:37:58,600 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql script on database.
29/06/2021 17:37:58,601 - INFO - [Workflow.py:35] - Running rv_to_bv flow.
29/06/2021 17:37:58,602 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:37:58,602 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_1_schema_structure.sql
29/06/2021 17:37:58,603 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql
29/06/2021 17:37:58,603 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,603 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql
29/06/2021 17:37:58,604 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

    IF (SELECT count(*) FROM raw_vault.sattrips_csv st WHERE st.loadenddate > time_now) >= 0 THEN

        DROP SCHEMA IF EXISTS business_vault CASCADE;
        
    END IF;

    CREATE SCHEMA IF NOT EXISTS business_vault;
    CREATE EXTENSION IF NOT EXISTS pgcrypto;
    COMMIT;

END $$; arguments.
29/06/2021 17:37:58,608 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,608 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

    IF (SELECT count(*) FROM raw_vault.sattrips_csv st WHERE st.loadenddate > time_now) >= 0 THEN

        DROP SCHEMA IF EXISTS business_vault CASCADE;
        
    END IF;

    CREATE SCHEMA IF NOT EXISTS business_vault;
    CREATE EXTENSION IF NOT EXISTS pgcrypto;
    COMMIT;

END $$; arguments.
29/06/2021 17:37:58,608 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql script on database.
29/06/2021 17:37:58,609 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_2_timedim.sql
29/06/2021 17:37:58,609 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql
29/06/2021 17:37:58,609 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,609 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql
29/06/2021 17:37:58,609 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, DO $$
DECLARE

	time_begin TIMESTAMP := CAST('2018-01-01' AS TIMESTAMP);
	time_end TIMESTAMP := CAST('2019-01-01' AS TIMESTAMP);

BEGIN

	IF NOT EXISTS (SELECT FROM pg_catalog.pg_tables WHERE schemaname = 'business_vault' AND tablename = 'timedim') THEN 

	CREATE TABLE IF NOT EXISTS business_vault.timedim(
		timeid SERIAL PRIMARY KEY,
		"hour" INTEGER,
		"day" INTEGER,
		timestring TIMESTAMP);

	COMMIT;

	INSERT INTO business_vault.timedim(
		"hour", 
		"day", 
		timestring)
		
	SELECT
		EXTRACT(HOUR FROM time_series),
		EXTRACT(DOY FROM time_series),
		time_series
		
	FROM generate_series(
		time_begin,
		time_end,
		CAST('1 hour' AS INTERVAL)
		) AS time_series;
		
	DROP INDEX IF EXISTS timestring_dim_index;
	DROP INDEX IF EXISTS timeid_dim_index;
	DROP INDEX IF EXISTS hour_dim_index;
	DROP INDEX IF EXISTS day_dim_index;
	
	CREATE INDEX IF NOT EXISTS timestring_dim_index ON business_vault.timedim(timestring);
	CREATE INDEX IF NOT EXISTS timeid_dim_index ON business_vault.timedim(timeid);
	CREATE INDEX IF NOT EXISTS hour_dim_index ON business_vault.timedim("hour");
	CREATE INDEX IF NOT EXISTS day_dim_index ON business_vault.timedim("day");

	END IF;
	
END $$; arguments.
29/06/2021 17:37:58,668 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,668 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, DO $$
DECLARE

	time_begin TIMESTAMP := CAST('2018-01-01' AS TIMESTAMP);
	time_end TIMESTAMP := CAST('2019-01-01' AS TIMESTAMP);

BEGIN

	IF NOT EXISTS (SELECT FROM pg_catalog.pg_tables WHERE schemaname = 'business_vault' AND tablename = 'timedim') THEN 

	CREATE TABLE IF NOT EXISTS business_vault.timedim(
		timeid SERIAL PRIMARY KEY,
		"hour" INTEGER,
		"day" INTEGER,
		timestring TIMESTAMP);

	COMMIT;

	INSERT INTO business_vault.timedim(
		"hour", 
		"day", 
		timestring)
		
	SELECT
		EXTRACT(HOUR FROM time_series),
		EXTRACT(DOY FROM time_series),
		time_series
		
	FROM generate_series(
		time_begin,
		time_end,
		CAST('1 hour' AS INTERVAL)
		) AS time_series;
		
	DROP INDEX IF EXISTS timestring_dim_index;
	DROP INDEX IF EXISTS timeid_dim_index;
	DROP INDEX IF EXISTS hour_dim_index;
	DROP INDEX IF EXISTS day_dim_index;
	
	CREATE INDEX IF NOT EXISTS timestring_dim_index ON business_vault.timedim(timestring);
	CREATE INDEX IF NOT EXISTS timeid_dim_index ON business_vault.timedim(timeid);
	CREATE INDEX IF NOT EXISTS hour_dim_index ON business_vault.timedim("hour");
	CREATE INDEX IF NOT EXISTS day_dim_index ON business_vault.timedim("day");

	END IF;
	
END $$; arguments.
29/06/2021 17:37:58,669 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql script on database.
29/06/2021 17:37:58,669 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_3_vendordim.sql
29/06/2021 17:37:58,669 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql
29/06/2021 17:37:58,670 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,670 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql
29/06/2021 17:37:58,670 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.vendordim(
		vendorid INTEGER PRIMARY KEY, 
		vendorname VARCHAR);
	
CREATE INDEX IF NOT EXISTS vendorid_dim_index ON business_vault.vendordim(vendorid); arguments.
29/06/2021 17:37:58,678 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,679 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.vendordim(
		vendorid INTEGER PRIMARY KEY, 
		vendorname VARCHAR);
	
CREATE INDEX IF NOT EXISTS vendorid_dim_index ON business_vault.vendordim(vendorid); arguments.
29/06/2021 17:37:58,679 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql script on database.
29/06/2021 17:37:58,680 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_4_payment_typedim.sql
29/06/2021 17:37:58,680 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql
29/06/2021 17:37:58,680 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,680 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql
29/06/2021 17:37:58,681 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_typedim(
	payment_typeid INTEGER PRIMARY KEY, 
	payment_type_name VARCHAR);
		
CREATE INDEX IF NOT EXISTS payment_type_dim_index ON business_vault.payment_typedim(payment_typeid);
 arguments.
29/06/2021 17:37:58,690 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,691 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_typedim(
	payment_typeid INTEGER PRIMARY KEY, 
	payment_type_name VARCHAR);
		
CREATE INDEX IF NOT EXISTS payment_type_dim_index ON business_vault.payment_typedim(payment_typeid);
 arguments.
29/06/2021 17:37:58,691 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql script on database.
29/06/2021 17:37:58,691 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_5_ratecodedim.sql
29/06/2021 17:37:58,692 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql
29/06/2021 17:37:58,692 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,692 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql
29/06/2021 17:37:58,692 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.ratecodedim(
	ratecodeid INTEGER PRIMARY KEY, 
	ratecodename VARCHAR);
	
CREATE INDEX IF NOT EXISTS ratecode_dim_index ON business_vault.ratecodedim(ratecodeid);
 arguments.
29/06/2021 17:37:58,700 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,701 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.ratecodedim(
	ratecodeid INTEGER PRIMARY KEY, 
	ratecodename VARCHAR);
	
CREATE INDEX IF NOT EXISTS ratecode_dim_index ON business_vault.ratecodedim(ratecodeid);
 arguments.
29/06/2021 17:37:58,701 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql script on database.
29/06/2021 17:37:58,702 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_6_boroughdim.sql
29/06/2021 17:37:58,702 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql
29/06/2021 17:37:58,703 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,703 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql
29/06/2021 17:37:58,703 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.boroughdim(
	boroughid SERIAL PRIMARY KEY, 
	boroughname VARCHAR);

CREATE INDEX IF NOT EXISTS boroughdim_index ON business_vault.boroughdim(boroughid);
 arguments.
29/06/2021 17:37:58,712 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,713 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.boroughdim(
	boroughid SERIAL PRIMARY KEY, 
	boroughname VARCHAR);

CREATE INDEX IF NOT EXISTS boroughdim_index ON business_vault.boroughdim(boroughid);
 arguments.
29/06/2021 17:37:58,713 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql script on database.
29/06/2021 17:37:58,714 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_7_service_zonedim.sql
29/06/2021 17:37:58,714 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql
29/06/2021 17:37:58,714 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,714 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql
29/06/2021 17:37:58,714 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zonedim(
	service_zoneid SERIAL PRIMARY KEY, 
	service_zonename VARCHAR);

CREATE INDEX IF NOT EXISTS service_zonedim_index ON business_vault.service_zonedim(service_zoneid); arguments.
29/06/2021 17:37:58,726 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,726 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zonedim(
	service_zoneid SERIAL PRIMARY KEY, 
	service_zonename VARCHAR);

CREATE INDEX IF NOT EXISTS service_zonedim_index ON business_vault.service_zonedim(service_zoneid); arguments.
29/06/2021 17:37:58,726 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql script on database.
29/06/2021 17:37:58,727 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,727 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,727 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,727 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,727 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zone_borough_correspondance(
	correspondanceid SERIAL PRIMARY KEY, 
	service_zoneid INTEGER, 
	boroughid INTEGER
	);

CREATE INDEX IF NOT EXISTS correspondanceid_dim_index ON business_vault.service_zone_borough_correspondance(correspondanceid);
CREATE INDEX IF NOT EXISTS service_zoneid_dim_index ON business_vault.service_zone_borough_correspondance(service_zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.service_zone_borough_correspondance(boroughid);
 arguments.
29/06/2021 17:37:58,741 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,741 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zone_borough_correspondance(
	correspondanceid SERIAL PRIMARY KEY, 
	service_zoneid INTEGER, 
	boroughid INTEGER
	);

CREATE INDEX IF NOT EXISTS correspondanceid_dim_index ON business_vault.service_zone_borough_correspondance(correspondanceid);
CREATE INDEX IF NOT EXISTS service_zoneid_dim_index ON business_vault.service_zone_borough_correspondance(service_zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.service_zone_borough_correspondance(boroughid);
 arguments.
29/06/2021 17:37:58,741 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql script on database.
29/06/2021 17:37:58,742 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_9_zonedim.sql
29/06/2021 17:37:58,742 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql
29/06/2021 17:37:58,742 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,742 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql
29/06/2021 17:37:58,742 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.zonedim(
	zoneid INTEGER PRIMARY KEY, 
	boroughid INTEGER, 
	zonename VARCHAR
	);

CREATE INDEX IF NOT EXISTS zoneid_dim_index ON business_vault.zonedim(zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.zonedim(boroughid);
 arguments.
29/06/2021 17:37:58,750 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,750 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.zonedim(
	zoneid INTEGER PRIMARY KEY, 
	boroughid INTEGER, 
	zonename VARCHAR
	);

CREATE INDEX IF NOT EXISTS zoneid_dim_index ON business_vault.zonedim(zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.zonedim(boroughid);
 arguments.
29/06/2021 17:37:58,750 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql script on database.
29/06/2021 17:37:58,751 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_10_payment_naturedim.sql
29/06/2021 17:37:58,751 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql
29/06/2021 17:37:58,751 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,751 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql
29/06/2021 17:37:58,751 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_naturedim(
	payment_natureid INTEGER PRIMARY KEY,
	payment_nature_name VARCHAR);

INSERT INTO business_vault.payment_naturedim(payment_natureid, payment_nature_name)
VALUES
(0, 'Refund'),
(1, 'Payment')
ON CONFLICT (payment_natureid)
DO NOTHING;

CREATE INDEX IF NOT EXISTS payment_nature_dim_index ON business_vault.payment_naturedim(payment_natureid);
 arguments.
29/06/2021 17:37:58,759 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,760 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_naturedim(
	payment_natureid INTEGER PRIMARY KEY,
	payment_nature_name VARCHAR);

INSERT INTO business_vault.payment_naturedim(payment_natureid, payment_nature_name)
VALUES
(0, 'Refund'),
(1, 'Payment')
ON CONFLICT (payment_natureid)
DO NOTHING;

CREATE INDEX IF NOT EXISTS payment_nature_dim_index ON business_vault.payment_naturedim(payment_natureid);
 arguments.
29/06/2021 17:37:58,760 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql script on database.
29/06/2021 17:37:58,760 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_11_tripfacts.sql
29/06/2021 17:37:58,761 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql
29/06/2021 17:37:58,761 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,761 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql
29/06/2021 17:37:58,761 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, CREATE TABLE IF NOT EXISTS business_vault.tripfacts(
		triphashkey BYTEA,
		pickuptimeid INTEGER, 
		dropofftimeid INTEGER, 
		puzoneid INTEGER, 
		dozoneid INTEGER, 
		vendorid INTEGER, 
		payment_typeid INTEGER, 
		ratecodeid INTEGER,
		passengercount INTEGER,
		total_amount DOUBLE PRECISION,
		tip_amount DOUBLE PRECISION,
		trip_distance DOUBLE PRECISION,
		is_payment INTEGER,
		trip_time INTERVAL,
		PRIMARY KEY (
			triphashkey,
			pickuptimeid, 
			dropofftimeid, 
			puzoneid, 
			dozoneid, 
			vendorid,
			ratecodeid,
			payment_typeid
			)
); arguments.
29/06/2021 17:37:58,768 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,768 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, CREATE TABLE IF NOT EXISTS business_vault.tripfacts(
		triphashkey BYTEA,
		pickuptimeid INTEGER, 
		dropofftimeid INTEGER, 
		puzoneid INTEGER, 
		dozoneid INTEGER, 
		vendorid INTEGER, 
		payment_typeid INTEGER, 
		ratecodeid INTEGER,
		passengercount INTEGER,
		total_amount DOUBLE PRECISION,
		tip_amount DOUBLE PRECISION,
		trip_distance DOUBLE PRECISION,
		is_payment INTEGER,
		trip_time INTERVAL,
		PRIMARY KEY (
			triphashkey,
			pickuptimeid, 
			dropofftimeid, 
			puzoneid, 
			dozoneid, 
			vendorid,
			ratecodeid,
			payment_typeid
			)
); arguments.
29/06/2021 17:37:58,768 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql script on database.
29/06/2021 17:37:58,769 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_1_tripfacts.sql
29/06/2021 17:37:58,769 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql
29/06/2021 17:37:58,769 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,769 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql
29/06/2021 17:37:58,770 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	DROP INDEX IF EXISTS puzoneid_tripfacts_index;
	DROP INDEX IF EXISTS dozoneid_tripfacts_index;
	DROP INDEX IF EXISTS pickuptimeid_tripfacts_index;
	DROP INDEX IF EXISTS dropofftimeid_tripfacts_index;
	DROP INDEX IF EXISTS vendorid_tripfacts_index;
	DROP INDEX IF EXISTS is_payment_tripfacts_index;
	DROP INDEX IF EXISTS payment_typeid_tripfacts_index;
	DROP INDEX IF EXISTS ratecodeid_tripfacts_index;
		
	INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now;

	COMMIT;

	CREATE INDEX IF NOT EXISTS puzoneid_tripfacts_index ON business_vault.tripfacts(puzoneid);
	CREATE INDEX IF NOT EXISTS dozoneid_tripfacts_index ON business_vault.tripfacts(dozoneid);
	CREATE INDEX IF NOT EXISTS pickuptimeid_tripfacts_index ON business_vault.tripfacts(pickuptimeid);
	CREATE INDEX IF NOT EXISTS dropofftimeid_tripfacts_index ON business_vault.tripfacts(dropofftimeid);
	CREATE INDEX IF NOT EXISTS vendorid_tripfacts_index ON business_vault.tripfacts(vendorid);
	CREATE INDEX IF NOT EXISTS is_payment_tripfacts_index ON business_vault.tripfacts(is_payment);
	CREATE INDEX IF NOT EXISTS payment_typeid_tripfacts_index ON business_vault.tripfacts(payment_typeid);
	CREATE INDEX IF NOT EXISTS ratecodeid_tripfacts_index ON business_vault.tripfacts(ratecodeid);

END $$; arguments.
29/06/2021 17:37:58,772 - DEBUG - [PostgreDBServer.py:199] - PostgreDBServer.log_psycopg2_exception starting with ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character
LINE 18:   st.triphashkey,
           ^
HINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.
QUERY:  INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now
CONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL
.
29/06/2021 17:37:58,773 - DEBUG - [PostgreDBServer.py:206] - PostgreDBServer.log_psycopg2_exception ended with ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character
LINE 18:   st.triphashkey,
           ^
HINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.
QUERY:  INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now
CONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL
, ('Psycopg2 ERROR: ', DatatypeMismatch("ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n"), 'on line number: ', 37, ' traceback: ', <traceback object at 0x03428408>, '-- type: ', <class 'psycopg2.errors.DatatypeMismatch'>, ' extensions.Diagnostics: ', <psycopg2.extensions.Diagnostics object at 0x03425390>, ' pgerror: ', "ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n", ' pgcode: ', '42804', 'value: ', DatatypeMismatch("ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n")).
29/06/2021 17:37:58,773 - ERROR - [PostgreDBServer.py:65] - ('Psycopg2 ERROR: ', DatatypeMismatch("ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n"), 'on line number: ', 37, ' traceback: ', <traceback object at 0x03428408>, '-- type: ', <class 'psycopg2.errors.DatatypeMismatch'>, ' extensions.Diagnostics: ', <psycopg2.extensions.Diagnostics object at 0x03425390>, ' pgerror: ', "ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n", ' pgcode: ', '42804', 'value: ', DatatypeMismatch("ERREUR:  la colonne  triphashkey  est de type bytea mais l'expression est de type character\nLINE 18:   st.triphashkey,\n           ^\nHINT:  Vous devez rcrire l'expression ou lui appliquer une transformation de type.\nQUERY:  INSERT INTO business_vault.tripfacts(\n\t\ttriphashkey,\n\t\tpickuptimeid,\n\t\tdropofftimeid,\n\t\tpuzoneid,\n\t\tdozoneid,\n\t\tvendorid,\n\t\tis_payment,\n\t\tpayment_typeid,\n\t\tratecodeid,\n\t\tpassengercount,\n\t\ttotal_amount,\n\t\ttip_amount,\n\t\ttrip_distance,\n\t\ttrip_time)\n\t\t\t\n\tSELECT \n\t\tst.triphashkey,\n\t\tputime.timeid, \n\t\tdotime.timeid, \n\t\tst.puzoneid, \n\t\tst.dozoneid, \n\t\tst.vendorid,\n\t\tst.is_payment,\n\t\tst.payment_type, \n\t\tst.ratecodeid, \n\t\tst.passenger_count,\n\t\tst.total_amount, \n\t\tst.tip_amount,\n\t\tst.trip_distance,\n\t\tst.tpep_dropoff_datetime - st.tpep_pickup_datetime\n\t\t\t\n\tFROM raw_vault.sattrips_csv st \n\t\t\t\tJOIN business_vault.timedim putime ON \n\t\t\t\t\t(st.tpep_pickup_datetime >= putime.timestring AND \n\t\t\t\t\tst.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\t\tJOIN business_vault.timedim dotime ON \n\t\t\t\t\t(st.tpep_dropoff_datetime >= dotime.timestring AND \n\t\t\t\t\tst.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')\n\t\t\n\tWHERE st.loadenddate > time_now\nCONTEXT:  fonction PL/pgSQL inline_code_block, ligne 19  instruction SQL\n"))
29/06/2021 17:37:58,777 - ERROR - [PostgreDBServer.py:66] - Error on query : DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	DROP INDEX IF EXISTS puzoneid_tripfacts_index;
	DROP INDEX IF EXISTS dozoneid_tripfacts_index;
	DROP INDEX IF EXISTS pickuptimeid_tripfacts_index;
	DROP INDEX IF EXISTS dropofftimeid_tripfacts_index;
	DROP INDEX IF EXISTS vendorid_tripfacts_index;
	DROP INDEX IF EXISTS is_payment_tripfacts_index;
	DROP INDEX IF EXISTS payment_typeid_tripfacts_index;
	DROP INDEX IF EXISTS ratecodeid_tripfacts_index;
		
	INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now;

	COMMIT;

	CREATE INDEX IF NOT EXISTS puzoneid_tripfacts_index ON business_vault.tripfacts(puzoneid);
	CREATE INDEX IF NOT EXISTS dozoneid_tripfacts_index ON business_vault.tripfacts(dozoneid);
	CREATE INDEX IF NOT EXISTS pickuptimeid_tripfacts_index ON business_vault.tripfacts(pickuptimeid);
	CREATE INDEX IF NOT EXISTS dropofftimeid_tripfacts_index ON business_vault.tripfacts(dropofftimeid);
	CREATE INDEX IF NOT EXISTS vendorid_tripfacts_index ON business_vault.tripfacts(vendorid);
	CREATE INDEX IF NOT EXISTS is_payment_tripfacts_index ON business_vault.tripfacts(is_payment);
	CREATE INDEX IF NOT EXISTS payment_typeid_tripfacts_index ON business_vault.tripfacts(payment_typeid);
	CREATE INDEX IF NOT EXISTS ratecodeid_tripfacts_index ON business_vault.tripfacts(ratecodeid);

END $$;
29/06/2021 17:37:58,783 - ERROR - [Workflow.py:126] - Error with the file handling. File : C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql, Error: E R R E U R :     l a   c o l o n n e      t r i p h a s h k e y      e s t   d e   t y p e   b y t e a   m a i s   l ' e x p r e s s i o n   e s t   d e   t y p e   c h a r a c t e r 
 L I N E   1 8 :       s t . t r i p h a s h k e y , 
                       ^ 
 H I N T :     V o u s   d e v e z   r   c r i r e   l ' e x p r e s s i o n   o u   l u i   a p p l i q u e r   u n e   t r a n s f o r m a t i o n   d e   t y p e . 
 Q U E R Y :     I N S E R T   I N T O   b u s i n e s s _ v a u l t . t r i p f a c t s ( 
 	 	 t r i p h a s h k e y , 
 	 	 p i c k u p t i m e i d , 
 	 	 d r o p o f f t i m e i d , 
 	 	 p u z o n e i d , 
 	 	 d o z o n e i d , 
 	 	 v e n d o r i d , 
 	 	 i s _ p a y m e n t , 
 	 	 p a y m e n t _ t y p e i d , 
 	 	 r a t e c o d e i d , 
 	 	 p a s s e n g e r c o u n t , 
 	 	 t o t a l _ a m o u n t , 
 	 	 t i p _ a m o u n t , 
 	 	 t r i p _ d i s t a n c e , 
 	 	 t r i p _ t i m e ) 
 	 	 	 
 	 S E L E C T   
 	 	 s t . t r i p h a s h k e y , 
 	 	 p u t i m e . t i m e i d ,   
 	 	 d o t i m e . t i m e i d ,   
 	 	 s t . p u z o n e i d ,   
 	 	 s t . d o z o n e i d ,   
 	 	 s t . v e n d o r i d , 
 	 	 s t . i s _ p a y m e n t , 
 	 	 s t . p a y m e n t _ t y p e ,   
 	 	 s t . r a t e c o d e i d ,   
 	 	 s t . p a s s e n g e r _ c o u n t , 
 	 	 s t . t o t a l _ a m o u n t ,   
 	 	 s t . t i p _ a m o u n t , 
 	 	 s t . t r i p _ d i s t a n c e , 
 	 	 s t . t p e p _ d r o p o f f _ d a t e t i m e   -   s t . t p e p _ p i c k u p _ d a t e t i m e 
 	 	 	 
 	 F R O M   r a w _ v a u l t . s a t t r i p s _ c s v   s t   
 	 	 	 	 J O I N   b u s i n e s s _ v a u l t . t i m e d i m   p u t i m e   O N   
 	 	 	 	 	 ( s t . t p e p _ p i c k u p _ d a t e t i m e   > =   p u t i m e . t i m e s t r i n g   A N D   
 	 	 	 	 	 s t . t p e p _ p i c k u p _ d a t e t i m e   < =   p u t i m e . t i m e s t r i n g   +   I N T E R V A L   ' 5 9   m i n u t e s   5 9   s e c o n d s ' ) 
 	 	 	 	 J O I N   b u s i n e s s _ v a u l t . t i m e d i m   d o t i m e   O N   
 	 	 	 	 	 ( s t . t p e p _ d r o p o f f _ d a t e t i m e   > =   d o t i m e . t i m e s t r i n g   A N D   
 	 	 	 	 	 s t . t p e p _ d r o p o f f _ d a t e t i m e   < =   d o t i m e . t i m e s t r i n g   +   I N T E R V A L   ' 5 9   m i n u t e s   5 9   s e c o n d s ' ) 
 	 	 
 	 W H E R E   s t . l o a d e n d d a t e   >   t i m e _ n o w 
 C O N T E X T :     f o n c t i o n   P L / p g S Q L   i n l i n e _ c o d e _ b l o c k ,   l i g n e   1 9      i n s t r u c t i o n   S Q L 

29/06/2021 17:37:58,819 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_2_service_zonedim.sql
29/06/2021 17:37:58,819 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql
29/06/2021 17:37:58,819 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,819 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql
29/06/2021 17:37:58,820 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zonedim(
		service_zonename) 
	SELECT DISTINCT 
		TRIM(BOTH FROM LOWER(service_zone)) AS "service_zone"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY
		service_zone ASC;
	
END $$; arguments.
29/06/2021 17:37:58,824 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,824 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zonedim(
		service_zonename) 
	SELECT DISTINCT 
		TRIM(BOTH FROM LOWER(service_zone)) AS "service_zone"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY
		service_zone ASC;
	
END $$; arguments.
29/06/2021 17:37:58,824 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql script on database.
29/06/2021 17:37:58,825 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_3_boroughdim.sql
29/06/2021 17:37:58,825 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql
29/06/2021 17:37:58,825 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,825 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql
29/06/2021 17:37:58,826 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.boroughdim(
		boroughname)
	SELECT
		DISTINCT TRIM(BOTH FROM LOWER(borough)) AS "borough"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY 
		borough ASC;
		
END $$; arguments.
29/06/2021 17:37:58,828 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,828 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.boroughdim(
		boroughname)
	SELECT
		DISTINCT TRIM(BOTH FROM LOWER(borough)) AS "borough"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY 
		borough ASC;
		
END $$; arguments.
29/06/2021 17:37:58,828 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql script on database.
29/06/2021 17:37:58,829 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_4_zonedim.sql
29/06/2021 17:37:58,829 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql
29/06/2021 17:37:58,829 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,829 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql
29/06/2021 17:37:58,830 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.zonedim(
		zoneid, 
		boroughid, 
		zonename)
	SELECT DISTINCT 
		zoneid, 
		boroughid,
		TRIM(BOTH FROM LOWER("zone")) AS "zone" 
	FROM raw_vault.satzones_csv
		INNER JOIN business_vault.boroughdim ON borough = boroughname
	WHERE loadenddate > time_now
	ORDER BY 
		zoneid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,833 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,834 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.zonedim(
		zoneid, 
		boroughid, 
		zonename)
	SELECT DISTINCT 
		zoneid, 
		boroughid,
		TRIM(BOTH FROM LOWER("zone")) AS "zone" 
	FROM raw_vault.satzones_csv
		INNER JOIN business_vault.boroughdim ON borough = boroughname
	WHERE loadenddate > time_now
	ORDER BY 
		zoneid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,834 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql script on database.
29/06/2021 17:37:58,835 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,835 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,835 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,835 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:37:58,835 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zone_borough_correspondance(
		service_zoneid, 
		boroughid)
	SELECT DISTINCT 
		service_zoneid,
		boroughid
	FROM raw_vault.satzones_csv 
		INNER JOIN business_vault.boroughdim ON borough = boroughname
		INNER JOIN business_vault.service_zonedim ON service_zonename = service_zone
	WHERE loadenddate > time_now
	ORDER BY 
		service_zoneid ASC, 
		boroughid ASC;

END $$; arguments.
29/06/2021 17:37:58,837 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,838 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zone_borough_correspondance(
		service_zoneid, 
		boroughid)
	SELECT DISTINCT 
		service_zoneid,
		boroughid
	FROM raw_vault.satzones_csv 
		INNER JOIN business_vault.boroughdim ON borough = boroughname
		INNER JOIN business_vault.service_zonedim ON service_zonename = service_zone
	WHERE loadenddate > time_now
	ORDER BY 
		service_zoneid ASC, 
		boroughid ASC;

END $$; arguments.
29/06/2021 17:37:58,838 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql script on database.
29/06/2021 17:37:58,838 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_6_ratecodedim.sql
29/06/2021 17:37:58,838 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql
29/06/2021 17:37:58,839 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,839 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql
29/06/2021 17:37:58,839 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.ratecodedim(
		ratecodeid, 
		ratecodename)
	SELECT DISTINCT 
		ratecodeid, 
		TRIM(BOTH FROM LOWER(ratecodename)) AS "ratecodename"
	FROM raw_vault.satratecodeids_csv
	WHERE loadenddate > time_now
	ORDER BY 
		ratecodeid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,841 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,842 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.ratecodedim(
		ratecodeid, 
		ratecodename)
	SELECT DISTINCT 
		ratecodeid, 
		TRIM(BOTH FROM LOWER(ratecodename)) AS "ratecodename"
	FROM raw_vault.satratecodeids_csv
	WHERE loadenddate > time_now
	ORDER BY 
		ratecodeid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,842 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql script on database.
29/06/2021 17:37:58,842 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_7_vendordim.sql
29/06/2021 17:37:58,842 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql
29/06/2021 17:37:58,842 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,842 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql
29/06/2021 17:37:58,843 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN
	
	INSERT INTO business_vault.vendordim(
		vendorid, 
		vendorname)
	SELECT DISTINCT 
		vendorid, 
		TRIM(BOTH FROM LOWER(vendorname)) AS "vendorname"
	FROM raw_vault.satvendors_csv
	WHERE loadenddate > time_now
	ORDER BY 
		vendorid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,844 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,845 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN
	
	INSERT INTO business_vault.vendordim(
		vendorid, 
		vendorname)
	SELECT DISTINCT 
		vendorid, 
		TRIM(BOTH FROM LOWER(vendorname)) AS "vendorname"
	FROM raw_vault.satvendors_csv
	WHERE loadenddate > time_now
	ORDER BY 
		vendorid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,845 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql script on database.
29/06/2021 17:37:58,845 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_8_payment_typedim.sql
29/06/2021 17:37:58,845 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql
29/06/2021 17:37:58,845 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,845 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql
29/06/2021 17:37:58,846 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN
			
	INSERT INTO business_vault.payment_typedim(
		payment_typeid, 
		payment_type_name)
	SELECT DISTINCT 
		paymenttypeid,
		TRIM(BOTH FROM LOWER(paymenttypename)) AS "paymenttypename"
	FROM raw_vault.satpaymenttypes_csv
	WHERE loadenddate > time_now
	ORDER BY 
		paymenttypeid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,847 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,848 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:37:58' AS TIMESTAMP);

BEGIN
			
	INSERT INTO business_vault.payment_typedim(
		payment_typeid, 
		payment_type_name)
	SELECT DISTINCT 
		paymenttypeid,
		TRIM(BOTH FROM LOWER(paymenttypename)) AS "paymenttypename"
	FROM raw_vault.satpaymenttypes_csv
	WHERE loadenddate > time_now
	ORDER BY 
		paymenttypeid ASC;
		
END $$; arguments.
29/06/2021 17:37:58,848 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql script on database.
29/06/2021 17:37:58,849 - INFO - [Workflow.py:35] - Running bv_to_infomart flow.
29/06/2021 17:37:58,849 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:37:58,849 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_1st_query.sql
29/06/2021 17:37:58,849 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql
29/06/2021 17:37:58,850 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,850 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql
29/06/2021 17:37:58,850 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_statistics_month_most_trips_per_year AS 
	SELECT 
		puzone.zonename AS "Pickup Zone Name", 
		dozone.zonename AS "Dropoff Zone Name", 
		(SELECT TO_CHAR(
	    	TO_DATE (CAST(EXTRACT(MONTH FROM td.timestring) AS TEXT), 'MM'), 'Month'
	    	)
		) 
		AS "Month Name",
		
		avg(total_amount) AS "Average Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Total Amount",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts)
		AS "1st Quartile Total Amount",
		
		min(total_amount) AS "Minimum Total Amount", 
		max(total_amount) AS "Maximum Total Amount", 
		sum(total_amount) AS "Sum Total Amount",
		count(*) AS "Count", 
		avg(passengercount) AS "Average Passsenger Count", 
		sum(passengercount) AS "Total Number of Passenger",
		sum(trip_distance) AS "Total Trip Distance",
		avg(trip_distance) AS "Average Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "1st Quartile Trip Distance",
		
		min(trip_distance) AS "Minimum Trip Distance", 
		max(trip_distance) AS "Maximum Trip Distance",
		avg(trip_time) AS "Average Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Time",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "Median Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts)
		AS "1st Quartile Trip Time",
		
		min(trip_time) AS "Minimum Trip Time", 
		max(trip_time) AS "Maximum Trip Time", 
		sum(trip_time) AS "Sum Trip Time",
		
		(SELECT 
			rcd.ratecodename
		FROM business_vault.tripfacts tf 
			JOIN business_vault.ratecodedim rcd ON tf.ratecodeid = rcd.ratecodeid
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			rcd.ratecodeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Rate",
		
		(SELECT 
			ptd.payment_type_name 
		FROM business_vault.tripfacts tf 
			JOIN business_vault.payment_typedim ptd ON tf.ratecodeid = ptd.payment_typeid 
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			ptd.payment_typeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Payment Method"
		
	FROM business_vault.tripfacts JOIN business_vault.zonedim puzone ON puzoneid = puzone.zoneid
		JOIN business_vault.zonedim dozone ON dozoneid = dozone.zoneid
		JOIN business_vault.timedim td ON td.timeid = pickuptimeid
	WHERE 
		EXTRACT(MONTH FROM td.timestring) = (
			SELECT 
				EXTRACT(MONTH FROM td2.timestring) AS "Month"
			FROM business_vault.tripfacts tf2 
				JOIN business_vault.timedim td2 ON td2.timeid = tf2.pickuptimeid
			GROUP BY 
				EXTRACT(MONTH FROM td2.timestring) 
			ORDER BY 
				count(*) DESC 
			LIMIT 1)
	GROUP BY 
		puzone.zonename,
		dozone.zonename,
		"Month Name"
	ORDER BY 
		count(*) DESC; arguments.
29/06/2021 17:37:58,860 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,861 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_statistics_month_most_trips_per_year AS 
	SELECT 
		puzone.zonename AS "Pickup Zone Name", 
		dozone.zonename AS "Dropoff Zone Name", 
		(SELECT TO_CHAR(
	    	TO_DATE (CAST(EXTRACT(MONTH FROM td.timestring) AS TEXT), 'MM'), 'Month'
	    	)
		) 
		AS "Month Name",
		
		avg(total_amount) AS "Average Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Total Amount",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts)
		AS "1st Quartile Total Amount",
		
		min(total_amount) AS "Minimum Total Amount", 
		max(total_amount) AS "Maximum Total Amount", 
		sum(total_amount) AS "Sum Total Amount",
		count(*) AS "Count", 
		avg(passengercount) AS "Average Passsenger Count", 
		sum(passengercount) AS "Total Number of Passenger",
		sum(trip_distance) AS "Total Trip Distance",
		avg(trip_distance) AS "Average Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "1st Quartile Trip Distance",
		
		min(trip_distance) AS "Minimum Trip Distance", 
		max(trip_distance) AS "Maximum Trip Distance",
		avg(trip_time) AS "Average Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Time",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "Median Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts)
		AS "1st Quartile Trip Time",
		
		min(trip_time) AS "Minimum Trip Time", 
		max(trip_time) AS "Maximum Trip Time", 
		sum(trip_time) AS "Sum Trip Time",
		
		(SELECT 
			rcd.ratecodename
		FROM business_vault.tripfacts tf 
			JOIN business_vault.ratecodedim rcd ON tf.ratecodeid = rcd.ratecodeid
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			rcd.ratecodeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Rate",
		
		(SELECT 
			ptd.payment_type_name 
		FROM business_vault.tripfacts tf 
			JOIN business_vault.payment_typedim ptd ON tf.ratecodeid = ptd.payment_typeid 
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			ptd.payment_typeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Payment Method"
		
	FROM business_vault.tripfacts JOIN business_vault.zonedim puzone ON puzoneid = puzone.zoneid
		JOIN business_vault.zonedim dozone ON dozoneid = dozone.zoneid
		JOIN business_vault.timedim td ON td.timeid = pickuptimeid
	WHERE 
		EXTRACT(MONTH FROM td.timestring) = (
			SELECT 
				EXTRACT(MONTH FROM td2.timestring) AS "Month"
			FROM business_vault.tripfacts tf2 
				JOIN business_vault.timedim td2 ON td2.timeid = tf2.pickuptimeid
			GROUP BY 
				EXTRACT(MONTH FROM td2.timestring) 
			ORDER BY 
				count(*) DESC 
			LIMIT 1)
	GROUP BY 
		puzone.zonename,
		dozone.zonename,
		"Month Name"
	ORDER BY 
		count(*) DESC; arguments.
29/06/2021 17:37:58,861 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql script on database.
29/06/2021 17:37:58,861 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_2nd_query.sql
29/06/2021 17:37:58,862 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql
29/06/2021 17:37:58,862 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x033F4688>, True
29/06/2021 17:37:58,862 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql
29/06/2021 17:37:58,862 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_frequency_hour_of_day AS 
	SELECT 
		zdpu.zonename AS "Pickup Zone Name", 
		zddo.zonename AS "Dropoff Zone Name",
		q."tot_am_sum" AS "Total Amount Sum", 
		td2."hour" AS "Hour", 
		q."ct" AS "Count"
		
	FROM (
		SELECT DISTINCT 
			"hour" 
		FROM business_vault.timedim) AS td2 
		JOIN LATERAL (
			SELECT 
				tf.puzoneid, 
				tf.dozoneid, 
				sum(tf.total_amount) AS "tot_am_sum", 
				td1."hour", 
				count(*) AS "ct"
			FROM business_vault.tripfacts tf JOIN business_vault.timedim td1 ON tf.pickuptimeid = td1.timeid 
			WHERE 
				--tf.puzoneid != 264 AND tf.dozoneid != 264 AND 
				td1."hour" = td2."hour"
			GROUP BY 
				td1."hour", 
				tf.puzoneid, 
				tf.dozoneid 
			ORDER BY 
				count(*) DESC 
			LIMIT 10
		) AS q ON TRUE
		JOIN business_vault.zonedim zdpu ON zdpu.zoneid = q.puzoneid
		JOIN business_vault.zonedim zddo ON zddo.zoneid = q.dozoneid
	ORDER BY 
		td2."hour" ASC, 
		q."ct" DESC;










 arguments.
29/06/2021 17:37:58,869 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:37:58,870 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0120E808>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_frequency_hour_of_day AS 
	SELECT 
		zdpu.zonename AS "Pickup Zone Name", 
		zddo.zonename AS "Dropoff Zone Name",
		q."tot_am_sum" AS "Total Amount Sum", 
		td2."hour" AS "Hour", 
		q."ct" AS "Count"
		
	FROM (
		SELECT DISTINCT 
			"hour" 
		FROM business_vault.timedim) AS td2 
		JOIN LATERAL (
			SELECT 
				tf.puzoneid, 
				tf.dozoneid, 
				sum(tf.total_amount) AS "tot_am_sum", 
				td1."hour", 
				count(*) AS "ct"
			FROM business_vault.tripfacts tf JOIN business_vault.timedim td1 ON tf.pickuptimeid = td1.timeid 
			WHERE 
				--tf.puzoneid != 264 AND tf.dozoneid != 264 AND 
				td1."hour" = td2."hour"
			GROUP BY 
				td1."hour", 
				tf.puzoneid, 
				tf.dozoneid 
			ORDER BY 
				count(*) DESC 
			LIMIT 10
		) AS q ON TRUE
		JOIN business_vault.zonedim zdpu ON zdpu.zoneid = q.puzoneid
		JOIN business_vault.zonedim zddo ON zddo.zoneid = q.dozoneid
	ORDER BY 
		td2."hour" ASC, 
		q."ct" DESC;










 arguments.
29/06/2021 17:37:58,870 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql script on database.
29/06/2021 17:37:58,870 - DEBUG - [PostgreDBServer.py:192] - PostgreDBServer.closeConn run on instance <PostgreDBServer.PostgreDBServer object at 0x0120E808>.
29/06/2021 17:37:58,871 - DEBUG - [PostgreDBServer.py:194] - <connection object at 0x033F9320; dsn: 'user=postgres password=xxx dbname=YellowTaxiTrips host=localhost port=5432', closed: 1> connection closed.
29/06/2021 17:52:04,753 - INFO - [FolderStructure.py:30] - Loaded logger yaml configuration at config/logger_config.yaml
29/06/2021 17:52:04,753 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on config/flows.yaml
29/06/2021 17:52:04,753 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:99] - FolderStructure.load starting on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:04,754 - INFO - [FolderStructure.py:106] - Reading C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml, forwarding python yaml dict.
29/06/2021 17:52:04,754 - DEBUG - [FolderStructure.py:115] - FolderStructure.read starting with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml arguments.
29/06/2021 17:52:04,763 - INFO - [FolderStructure.py:121] - YAML configuration file successfully read.
29/06/2021 17:52:04,764 - DEBUG - [FolderStructure.py:134] - FolderStructure.read ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]} arguments.
29/06/2021 17:52:04,765 - DEBUG - [FolderStructure.py:110] - FolderStructure.load ended with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\config\flows.yaml, {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]}
29/06/2021 17:52:04,765 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound loaded.
29/06/2021 17:52:04,765 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work loaded.
29/06/2021 17:52:04,765 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\error loaded.
29/06/2021 17:52:04,765 - DEBUG - [FolderStructure.py:42] - File directory C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done loaded.
29/06/2021 17:52:04,765 - INFO - [FolderStructure.py:43] - File directories set up.
29/06/2021 17:52:04,766 - DEBUG - [FolderStructure.py:138] - FolderStructure.get_config run for config configuration type.
29/06/2021 17:52:04,766 - DEBUG - [FolderStructure.py:146] - config type config returned {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}
29/06/2021 17:52:04,766 - DEBUG - [FolderStructure.py:138] - FolderStructure.get_config run for flows configuration type.
29/06/2021 17:52:04,766 - DEBUG - [FolderStructure.py:146] - flows type config returned {'flows': [{'name': 'raw_vault_and_infomart_schema_creation', 'type': 'inner_database_flux', 'sql': ['create_raw_vault_structure.sql', 'information_mart_schema_creation.sql', 'staging_area_create_schema_structure.sql']}, {'name': 'paymenttypes_to_rv', 'type': 'file_to_rv', 'rv_object': 'paymenttypes', 'file_regex': '^paymenttypes_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'ratecodeids_to_rv', 'type': 'file_to_rv', 'rv_object': 'ratecodeids', 'file_regex': '^ratecodeids_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'vendors_to_rv', 'type': 'file_to_rv', 'rv_object': 'vendors', 'file_regex': '^vendors_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'trips_to_rv', 'type': 'file_to_rv', 'rv_object': 'trips', 'file_regex': '^trips_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'zones_to_rv', 'type': 'file_to_rv', 'rv_object': 'zones', 'file_regex': '^zones_(?P<origin>.+?)_(?P<date>.+?)_.+?[.](?P<ext>.+?)$'}, {'name': 'sa_to_rv', 'type': 'inner_database_flux', 'hashfunc': 'sha256', 'origin': 'csv', 'sql': ['raw_vault_load_1_hubtrips.sql', 'raw_vault_load_2_sattrips.sql', 'raw_vault_load_3_update_sattrips.sql', 'raw_vault_load_4_hubzones.sql', 'raw_vault_load_5_satzones.sql', 'raw_vault_load_6_update_satzones.sql', 'raw_vault_load_7_hubratecodeids.sql', 'raw_vault_load_8_satratecodeids.sql', 'raw_vault_load_9_update_satratecodeids.sql', 'raw_vault_load_10_hubpaymenttypes.sql', 'raw_vault_load_11_satpaymenttypes.sql', 'raw_vault_load_12_update_satpaymenttypes.sql', 'raw_vault_load_13_hubvendors.sql', 'raw_vault_load_14_satvendors.sql', 'raw_vault_load_15_update_satvendors.sql', 'raw_vault_load_16_linktrips.sql']}, {'name': 'rv_to_bv', 'type': 'inner_database_flux', 'time_start': '2018-01-01', 'time_end': '2019-01-01', 'bv_drop_trigger': 0, 'sql': ['business_vault_create_1_schema_structure.sql', 'business_vault_create_2_timedim.sql', 'business_vault_create_3_vendordim.sql', 'business_vault_create_4_payment_typedim.sql', 'business_vault_create_5_ratecodedim.sql', 'business_vault_create_6_boroughdim.sql', 'business_vault_create_7_service_zonedim.sql', 'business_vault_create_8_service_zone_borough_correspondance.sql', 'business_vault_create_9_zonedim.sql', 'business_vault_create_10_payment_naturedim.sql', 'business_vault_create_11_tripfacts.sql', 'business_vault_load_1_tripfacts.sql', 'business_vault_load_2_service_zonedim.sql', 'business_vault_load_3_boroughdim.sql', 'business_vault_load_4_zonedim.sql', 'business_vault_load_5_service_zone_borough_correspondance.sql', 'business_vault_load_6_ratecodedim.sql', 'business_vault_load_7_vendordim.sql', 'business_vault_load_8_payment_typedim.sql']}, {'name': 'bv_to_infomart', 'type': 'inner_database_flux', 'sql': ['information_mart_1st_query.sql', 'information_mart_2nd_query.sql']}]}
29/06/2021 17:52:04,766 - DEBUG - [Workflow.py:28] - Running flows from flow file.
29/06/2021 17:52:04,766 - DEBUG - [Workflow.py:168] - Workflow.get_connection with <Workflow.Workflow object at 0x01DE08F8> arguments.
29/06/2021 17:52:04,766 - DEBUG - [Workflow.py:161] - Workflow.request_info starting.
29/06/2021 17:52:13,638 - DEBUG - [Workflow.py:164] - Workflow.request_info with username : postgres
29/06/2021 17:52:13,638 - DEBUG - [Workflow.py:176] - Fetching database handling class at PostgreDBServer.PostgreDBServer using the configuration.
29/06/2021 17:52:13,638 - DEBUG - [PostgreDBServer.py:10] - __init__ starting with {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}, postgres and user inputed password arguments.
29/06/2021 17:52:13,699 - INFO - [PostgreDBServer.py:22] - Established connection with the database of PostgreDBServer type with autocommit.
29/06/2021 17:52:13,700 - DEBUG - [PostgreDBServer.py:29] - __init__ ended with <connection object at 0x01D704E8; dsn: 'user=postgres password=xxx dbname=YellowTaxiTrips host=localhost port=5432', closed: 0> connection object, postgres user and config {'data_directory_path': {'base_path': 'data', 'directories': ['inbound', 'work', 'error', 'done'], 'sql_scripts': 'sql_scripts'}, 'db_info': {'engine': 'PostgreDBServer', 'server': 'localhost', 'name': 'YellowTaxiTrips', 'port': 5432, 'table_name': 'staging_area.raw{rv_object}file_{ext}'}, 'logger_config_path': 'config/logger_config.yaml', 'flows_path': 'config/flows.yaml'}
29/06/2021 17:52:13,700 - DEBUG - [Workflow.py:190] - Workflow.get_connection ended with [<Workflow.Workflow object at 0x01DE08F8>, <PostgreDBServer.PostgreDBServer object at 0x0146E748>] return variables.
29/06/2021 17:52:13,700 - DEBUG - [PostgreDBServer.py:158] - Sarting PostgreDBServer.get_now with <PostgreDBServer.PostgreDBServer object at 0x0146E748> instance.
29/06/2021 17:52:13,700 - INFO - [PostgreDBServer.py:162] - Fetching current time from database.
29/06/2021 17:52:13,701 - INFO - [PostgreDBServer.py:167] - Current time is 2021-06-29 17:52:13
29/06/2021 17:52:13,702 - DEBUG - [PostgreDBServer.py:187] - Ending get_now with 2021-06-29 17:52:13 as current database time.
29/06/2021 17:52:13,702 - INFO - [Workflow.py:33] - Iterating over flows.
29/06/2021 17:52:13,703 - INFO - [Workflow.py:35] - Running raw_vault_and_infomart_schema_creation flow.
29/06/2021 17:52:13,703 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:52:13,703 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/create_raw_vault_structure.sql
29/06/2021 17:52:13,704 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql
29/06/2021 17:52:13,704 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,704 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql
29/06/2021 17:52:13,704 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
-- DROP SCHEMA raw_vault;

CREATE SCHEMA IF NOT EXISTS raw_vault;
-- Drop table

-- DROP TABLE raw_vault.hubpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.hubpaymenttypes (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubpaymenttypes_un UNIQUE (paymenttypehashkey)
);


-- raw_vault.hubratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.hubratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.hubratecodeids (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubratecodeids_un UNIQUE (ratecodenamehashkey)
);


-- raw_vault.hubtrips definition

-- Drop table

-- DROP TABLE raw_vault.hubtrips;

CREATE TABLE IF NOT EXISTS raw_vault.hubtrips (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	vendorid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT hubtrips_un UNIQUE (triphashkey)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_pickup_datetime);


-- raw_vault.hubvendors definition

-- Drop table

-- DROP TABLE raw_vault.hubvendors;

CREATE TABLE IF NOT EXISTS raw_vault.hubvendors (
	vendorhashkey CHAR(64) NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubvendors_csv_un UNIQUE (vendorhashkey)
);


-- raw_vault.hubzones definition

-- Drop table

-- DROP TABLE raw_vault.hubzones;

CREATE TABLE IF NOT EXISTS raw_vault.hubzones (
	zonenamehashkey CHAR(64) NOT NULL,
	"zone" varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	borough varchar NULL,
	service_zone varchar NULL,
	CONSTRAINT hublocation_un UNIQUE (zonenamehashkey)
);


-- raw_vault.rawpaymenttypesfile definition

-- Drop table

-- DROP TABLE raw_vault.rawpaymenttypesfile;




-- raw_vault.satpaymenttypes definition

-- Drop table

-- DROP TABLE raw_vault.satpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.satpaymenttypes_csv (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypeid int4 NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satpaymenttypes_csv_un UNIQUE (paymenttypehashkey, loaddate)
);


-- raw_vault.satratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.satratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.satratecodeids_csv (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodeid int4 NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satratecodeids_csv_un UNIQUE (ratecodenamehashkey, loaddate)
);


-- raw_vault.sattrips definition

-- Drop table

-- DROP TABLE raw_vault.sattrips;

CREATE TABLE IF NOT EXISTS raw_vault.sattrips_csv (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	passenger_count int4 NULL,
	loadenddate timestamp(0) NOT NULL,
	trip_distance float8 NULL,
	ratecodeid int4 NULL,
	store_and_fwd_flag varchar NULL,
	payment_type int4 NULL,
	fare_amount float8 NULL,
	extra float8 NULL,
	mta_tax float8 NULL,
	improvement_surcharge float8 NULL,
	tip_amount float8 NULL,
	tolls_amount float8 NULL,
	total_amount float8 NOT NULL,
	vendorid int4 NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT sattrips_csv_un UNIQUE (triphashkey, loaddate)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_pickup_datetime);


-- raw_vault.satvendors definition

-- Drop table

-- DROP TABLE raw_vault.satvendors;

CREATE TABLE IF NOT EXISTS raw_vault.satvendors_csv (
	vendorhashkey CHAR(64) NULL,
	vendorid int4 NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	loadenddate timestamp(0) NULL,
	CONSTRAINT satvendors_csv_un UNIQUE (vendorhashkey, loaddate)
);


-- raw_vault.satzones definition

-- Drop table

-- DROP TABLE raw_vault.satzones;

CREATE TABLE IF NOT EXISTS raw_vault.satzones_csv (
	zonenamehashkey CHAR(64) NOT NULL,
	borough varchar NOT NULL,
	"zone" varchar NOT NULL,
	service_zone varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	loadenddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	zoneid int4 NOT NULL,
	CONSTRAINT satzones_csv_un UNIQUE (zonenamehashkey, loaddate)
);


-- raw_vault.linktrips definition

-- Drop table

-- DROP TABLE raw_vault.linktrips

CREATE TABLE IF NOT EXISTS raw_vault.linktrips(
	linktriphashkey CHAR(64) NOT NULL,
	triphashkey CHAR(64) NOT NULL,
	puzonenamehashkey CHAR(64) NOT NULL,
	dozonenamehashkey CHAR(64) NOT NULL,
	vendorhashkey CHAR(64) NOT NULL,
	ratecodenamehashkey CHAR(64) NOT NULL,
	paymenttypehashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	CONSTRAINT linktrip_un UNIQUE (linktriphashkey)
);
 arguments.
29/06/2021 17:52:13,717 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,717 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
-- DROP SCHEMA raw_vault;

CREATE SCHEMA IF NOT EXISTS raw_vault;
-- Drop table

-- DROP TABLE raw_vault.hubpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.hubpaymenttypes (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubpaymenttypes_un UNIQUE (paymenttypehashkey)
);


-- raw_vault.hubratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.hubratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.hubratecodeids (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubratecodeids_un UNIQUE (ratecodenamehashkey)
);


-- raw_vault.hubtrips definition

-- Drop table

-- DROP TABLE raw_vault.hubtrips;

CREATE TABLE IF NOT EXISTS raw_vault.hubtrips (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	vendorid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT hubtrips_un UNIQUE (triphashkey)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips USING btree (tpep_pickup_datetime);


-- raw_vault.hubvendors definition

-- Drop table

-- DROP TABLE raw_vault.hubvendors;

CREATE TABLE IF NOT EXISTS raw_vault.hubvendors (
	vendorhashkey CHAR(64) NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT hubvendors_csv_un UNIQUE (vendorhashkey)
);


-- raw_vault.hubzones definition

-- Drop table

-- DROP TABLE raw_vault.hubzones;

CREATE TABLE IF NOT EXISTS raw_vault.hubzones (
	zonenamehashkey CHAR(64) NOT NULL,
	"zone" varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	borough varchar NULL,
	service_zone varchar NULL,
	CONSTRAINT hublocation_un UNIQUE (zonenamehashkey)
);


-- raw_vault.rawpaymenttypesfile definition

-- Drop table

-- DROP TABLE raw_vault.rawpaymenttypesfile;




-- raw_vault.satpaymenttypes definition

-- Drop table

-- DROP TABLE raw_vault.satpaymenttypes;

CREATE TABLE IF NOT EXISTS raw_vault.satpaymenttypes_csv (
	paymenttypehashkey CHAR(64) NULL,
	paymenttypeid int4 NULL,
	paymenttypename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satpaymenttypes_csv_un UNIQUE (paymenttypehashkey, loaddate)
);


-- raw_vault.satratecodeids definition

-- Drop table

-- DROP TABLE raw_vault.satratecodeids;

CREATE TABLE IF NOT EXISTS raw_vault.satratecodeids_csv (
	ratecodenamehashkey CHAR(64) NULL,
	ratecodeid int4 NULL,
	ratecodename varchar NULL,
	loaddate timestamp(0) NULL,
	loadenddate timestamp(0) NULL,
	recordsource varchar NULL,
	CONSTRAINT satratecodeids_csv_un UNIQUE (ratecodenamehashkey, loaddate)
);


-- raw_vault.sattrips definition

-- Drop table

-- DROP TABLE raw_vault.sattrips;

CREATE TABLE IF NOT EXISTS raw_vault.sattrips_csv (
	triphashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	passenger_count int4 NULL,
	loadenddate timestamp(0) NOT NULL,
	trip_distance float8 NULL,
	ratecodeid int4 NULL,
	store_and_fwd_flag varchar NULL,
	payment_type int4 NULL,
	fare_amount float8 NULL,
	extra float8 NULL,
	mta_tax float8 NULL,
	improvement_surcharge float8 NULL,
	tip_amount float8 NULL,
	tolls_amount float8 NULL,
	total_amount float8 NOT NULL,
	vendorid int4 NOT NULL,
	tpep_pickup_datetime timestamp(0) NOT NULL,
	tpep_dropoff_datetime timestamp(0) NOT NULL,
	puzoneid int4 NOT NULL,
	dozoneid int4 NOT NULL,
	is_payment int4 NOT NULL,
	CONSTRAINT sattrips_csv_un UNIQUE (triphashkey, loaddate)
);
CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_dropoff_datetime);
CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv USING btree (tpep_pickup_datetime);


-- raw_vault.satvendors definition

-- Drop table

-- DROP TABLE raw_vault.satvendors;

CREATE TABLE IF NOT EXISTS raw_vault.satvendors_csv (
	vendorhashkey CHAR(64) NULL,
	vendorid int4 NULL,
	vendorname varchar NULL,
	loaddate timestamp(0) NULL,
	recordsource varchar NULL,
	loadenddate timestamp(0) NULL,
	CONSTRAINT satvendors_csv_un UNIQUE (vendorhashkey, loaddate)
);


-- raw_vault.satzones definition

-- Drop table

-- DROP TABLE raw_vault.satzones;

CREATE TABLE IF NOT EXISTS raw_vault.satzones_csv (
	zonenamehashkey CHAR(64) NOT NULL,
	borough varchar NOT NULL,
	"zone" varchar NOT NULL,
	service_zone varchar NOT NULL,
	loaddate timestamp(0) NOT NULL,
	loadenddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	zoneid int4 NOT NULL,
	CONSTRAINT satzones_csv_un UNIQUE (zonenamehashkey, loaddate)
);


-- raw_vault.linktrips definition

-- Drop table

-- DROP TABLE raw_vault.linktrips

CREATE TABLE IF NOT EXISTS raw_vault.linktrips(
	linktriphashkey CHAR(64) NOT NULL,
	triphashkey CHAR(64) NOT NULL,
	puzonenamehashkey CHAR(64) NOT NULL,
	dozonenamehashkey CHAR(64) NOT NULL,
	vendorhashkey CHAR(64) NOT NULL,
	ratecodenamehashkey CHAR(64) NOT NULL,
	paymenttypehashkey CHAR(64) NOT NULL,
	loaddate timestamp(0) NOT NULL,
	recordsource varchar NOT NULL,
	CONSTRAINT linktrip_un UNIQUE (linktriphashkey)
);
 arguments.
29/06/2021 17:52:13,718 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\create_raw_vault_structure.sql script on database.
29/06/2021 17:52:13,718 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_schema_creation.sql
29/06/2021 17:52:13,718 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql
29/06/2021 17:52:13,719 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,719 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql
29/06/2021 17:52:13,719 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DROP SCHEMA IF EXISTS information_mart CASCADE;
CREATE SCHEMA information_mart;
CREATE EXTENSION IF NOT EXISTS pgcrypto; arguments.
29/06/2021 17:52:13,728 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,728 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DROP SCHEMA IF EXISTS information_mart CASCADE;
CREATE SCHEMA information_mart;
CREATE EXTENSION IF NOT EXISTS pgcrypto; arguments.
29/06/2021 17:52:13,729 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_schema_creation.sql script on database.
29/06/2021 17:52:13,729 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/staging_area_create_schema_structure.sql
29/06/2021 17:52:13,730 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql
29/06/2021 17:52:13,730 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,730 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql
29/06/2021 17:52:13,730 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, CREATE SCHEMA IF NOT EXISTS staging_area;

CREATE TABLE IF NOT EXISTS staging_area.rawpaymenttypesfile_csv (
	paymenttype_id varchar NULL,
	paymenttype_name varchar NULL
);


-- staging_area.rawratecodeidsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawratecodeidsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawratecodeidsfile_csv (
	ratecodeid varchar NULL,
	ratecodename varchar NULL
);


-- staging_area.rawtripsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawtripsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawtripsfile_csv (
	vendorid varchar NULL,
	tpep_pickup_datetime varchar NULL,
	tpep_dropoff_datetime varchar NULL,
	passenger_count varchar NULL,
	trip_distance varchar NULL,
	ratecodeid varchar NULL,
	store_and_fwd_flag varchar NULL,
	puzoneid varchar NULL,
	dozoneid varchar NULL,
	payment_type varchar NULL,
	fare_amount varchar NULL,
	extra varchar NULL,
	mta_tax varchar NULL,
	tip_amount varchar NULL,
	tolls_amount varchar NULL,
	improvement_surcharge varchar NULL,
	total_amount varchar NULL
);


-- staging_area.rawvendorsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawvendorsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawvendorsfile_csv (
	vendorid varchar NULL,
	vendorname varchar NULL
);


-- staging_area.rawzonesfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawzonesfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawzonesfile_csv (
	zoneid varchar NULL,
	borough varchar NULL,
	"zone" varchar NULL,
	service_zone varchar NULL
); arguments.
29/06/2021 17:52:13,731 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,731 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, CREATE SCHEMA IF NOT EXISTS staging_area;

CREATE TABLE IF NOT EXISTS staging_area.rawpaymenttypesfile_csv (
	paymenttype_id varchar NULL,
	paymenttype_name varchar NULL
);


-- staging_area.rawratecodeidsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawratecodeidsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawratecodeidsfile_csv (
	ratecodeid varchar NULL,
	ratecodename varchar NULL
);


-- staging_area.rawtripsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawtripsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawtripsfile_csv (
	vendorid varchar NULL,
	tpep_pickup_datetime varchar NULL,
	tpep_dropoff_datetime varchar NULL,
	passenger_count varchar NULL,
	trip_distance varchar NULL,
	ratecodeid varchar NULL,
	store_and_fwd_flag varchar NULL,
	puzoneid varchar NULL,
	dozoneid varchar NULL,
	payment_type varchar NULL,
	fare_amount varchar NULL,
	extra varchar NULL,
	mta_tax varchar NULL,
	tip_amount varchar NULL,
	tolls_amount varchar NULL,
	improvement_surcharge varchar NULL,
	total_amount varchar NULL
);


-- staging_area.rawvendorsfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawvendorsfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawvendorsfile_csv (
	vendorid varchar NULL,
	vendorname varchar NULL
);


-- staging_area.rawzonesfile_csv definition

-- Drop table

-- DROP TABLE staging_area.rawzonesfile_csv;

CREATE TABLE IF NOT EXISTS staging_area.rawzonesfile_csv (
	zoneid varchar NULL,
	borough varchar NULL,
	"zone" varchar NULL,
	service_zone varchar NULL
); arguments.
29/06/2021 17:52:13,731 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\staging_area_create_schema_structure.sql script on database.
29/06/2021 17:52:13,732 - INFO - [Workflow.py:35] - Running paymenttypes_to_rv flow.
29/06/2021 17:52:13,733 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:52:13,733 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:52:13,733 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x01DE09E8>
29/06/2021 17:52:13,733 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:52:13,734 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:52:13,734 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\paymenttypes_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:52:13,734 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,735 - INFO - [FolderStructure.py:57] - Moved paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,735 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,735 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawpaymenttypesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,738 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawpaymenttypesfile_csv using PostgreDBServer database.
29/06/2021 17:52:13,739 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawpaymenttypesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,739 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:52:13,739 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\paymenttypes_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,739 - INFO - [FolderStructure.py:57] - Moved paymenttypes_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:52:13,740 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\paymenttypes_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,740 - INFO - [Workflow.py:35] - Running ratecodeids_to_rv flow.
29/06/2021 17:52:13,740 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:52:13,740 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:52:13,740 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x01DE09E8>
29/06/2021 17:52:13,740 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:52:13,741 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:52:13,741 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\ratecodeids_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:52:13,741 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,742 - INFO - [FolderStructure.py:57] - Moved ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,742 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,742 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawratecodeidsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,743 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawratecodeidsfile_csv using PostgreDBServer database.
29/06/2021 17:52:13,744 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawratecodeidsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,744 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:52:13,744 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\ratecodeids_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,744 - INFO - [FolderStructure.py:57] - Moved ratecodeids_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:52:13,745 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\ratecodeids_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,745 - INFO - [Workflow.py:35] - Running vendors_to_rv flow.
29/06/2021 17:52:13,745 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:52:13,745 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:52:13,745 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x01DE09E8>
29/06/2021 17:52:13,745 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:52:13,746 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:52:13,746 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\vendors_csv-file_08-06-2021_reference.csv and work arguments.
29/06/2021 17:52:13,746 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,747 - INFO - [FolderStructure.py:57] - Moved vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,747 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,747 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawvendorsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,749 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv loaded in YellowTaxiTrips. staging_area.rawvendorsfile_csv using PostgreDBServer database.
29/06/2021 17:52:13,749 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawvendorsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv arguments.
29/06/2021 17:52:13,749 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv and done arguments.
29/06/2021 17:52:13,749 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\vendors_csv-file_08-06-2021_reference.csv
29/06/2021 17:52:13,750 - INFO - [FolderStructure.py:57] - Moved vendors_csv-file_08-06-2021_reference.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:52:13,750 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\vendors_csv-file_08-06-2021_reference.csv.
29/06/2021 17:52:13,750 - INFO - [Workflow.py:35] - Running trips_to_rv flow.
29/06/2021 17:52:13,751 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:52:13,751 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:52:13,751 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x01DE09E8>
29/06/2021 17:52:13,751 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:52:13,751 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 2 files.
29/06/2021 17:52:13,751 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml.csv and work arguments.
29/06/2021 17:52:13,752 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv
29/06/2021 17:52:13,752 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,752 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv.
29/06/2021 17:52:13,753 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawtripsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv arguments.
29/06/2021 17:52:13,760 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv loaded in YellowTaxiTrips. staging_area.rawtripsfile_csv using PostgreDBServer database.
29/06/2021 17:52:13,760 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawtripsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv arguments.
29/06/2021 17:52:13,760 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv and done arguments.
29/06/2021 17:52:13,760 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\trips_csv-file_31-05-2021_preml.csv
29/06/2021 17:52:13,761 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:52:13,762 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\trips_csv-file_31-05-2021_preml.csv.
29/06/2021 17:52:13,762 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml_error.csv and work arguments.
29/06/2021 17:52:13,762 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\trips_csv-file_31-05-2021_preml_error.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv
29/06/2021 17:52:13,763 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml_error.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,763 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv.
29/06/2021 17:52:13,763 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawtripsfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv arguments.
29/06/2021 17:52:13,765 - DEBUG - [PostgreDBServer.py:199] - PostgreDBServer.log_psycopg2_exception starting with ERREUR:  donnes supplmentaires aprs la dernire colonne attendue
CONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 
.
29/06/2021 17:52:13,765 - DEBUG - [PostgreDBServer.py:206] - PostgreDBServer.log_psycopg2_exception ended with ERREUR:  donnes supplmentaires aprs la dernire colonne attendue
CONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 
, ('Psycopg2 ERROR: ', BadCopyFileFormat('ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n'), 'on line number: ', 98, ' traceback: ', <traceback object at 0x0367B3A8>, '-- type: ', <class 'psycopg2.errors.BadCopyFileFormat'>, ' extensions.Diagnostics: ', <psycopg2.extensions.Diagnostics object at 0x0360FB60>, ' pgerror: ', 'ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n', ' pgcode: ', '22P04', 'value: ', BadCopyFileFormat('ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n')).
29/06/2021 17:52:13,765 - ERROR - [PostgreDBServer.py:108] - ('Psycopg2 ERROR: ', BadCopyFileFormat('ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n'), 'on line number: ', 98, ' traceback: ', <traceback object at 0x0367B3A8>, '-- type: ', <class 'psycopg2.errors.BadCopyFileFormat'>, ' extensions.Diagnostics: ', <psycopg2.extensions.Diagnostics object at 0x0360FB60>, ' pgerror: ', 'ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n', ' pgcode: ', '22P04', 'value: ', BadCopyFileFormat('ERREUR:  donnes supplmentaires aprs la dernire colonne attendue\nCONTEXT:  COPY rawtripsfile_csv, ligne 45 :  2,08/12/2018 08:33:41 PM,08/12/2018 09:07:08 PM,1,10.77,1,N,138,25,1,3,2.5,0.5,0.5,6,0,0.3,39.8 \n'))
29/06/2021 17:52:13,767 - ERROR - [PostgreDBServer.py:109] - Error on copy from staging_area.rawtripsfile_csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv
29/06/2021 17:52:13,777 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv and error arguments.
29/06/2021 17:52:13,777 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\trips_csv-file_31-05-2021_preml_error.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\error\trips_csv-file_31-05-2021_preml_error.csv
29/06/2021 17:52:13,778 - INFO - [FolderStructure.py:57] - Moved trips_csv-file_31-05-2021_preml_error.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\error
29/06/2021 17:52:13,779 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\error\trips_csv-file_31-05-2021_preml_error.csv.
29/06/2021 17:52:13,779 - INFO - [Workflow.py:35] - Running zones_to_rv flow.
29/06/2021 17:52:13,779 - DEBUG - [Workflow.py:39] - Flow of type : file_to_rv
29/06/2021 17:52:13,779 - DEBUG - [Workflow.py:43] - Fetching inbound file list.
29/06/2021 17:52:13,779 - DEBUG - [FolderStructure.py:76] - Starting FolderStructure.get_Inbound_List on <FolderStructure.FolderStructure object at 0x01DE09E8>
29/06/2021 17:52:13,779 - INFO - [FolderStructure.py:82] - Fetching list of files in inbound.
29/06/2021 17:52:13,780 - DEBUG - [FolderStructure.py:85] - Ending FolderStructure.get_Inbound_List, found 1 files.
29/06/2021 17:52:13,780 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\zones_csv-file_31-05-2021_taxizone.csv and work arguments.
29/06/2021 17:52:13,780 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\inbound\zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv
29/06/2021 17:52:13,781 - INFO - [FolderStructure.py:57] - Moved zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work
29/06/2021 17:52:13,781 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv.
29/06/2021 17:52:13,781 - DEBUG - [PostgreDBServer.py:87] - PostgreDBServer.copy_from started with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawzonesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv arguments.
29/06/2021 17:52:13,784 - INFO - [PostgreDBServer.py:99] - C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv loaded in YellowTaxiTrips. staging_area.rawzonesfile_csv using PostgreDBServer database.
29/06/2021 17:52:13,784 - DEBUG - [PostgreDBServer.py:155] - PostgreDBServer.copy_from ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, staging_area.rawzonesfile_csv, C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv arguments.
29/06/2021 17:52:13,784 - DEBUG - [FolderStructure.py:49] - Starting FolderStructure.Move_To_Directory with C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv and done arguments.
29/06/2021 17:52:13,784 - DEBUG - [FolderStructure.py:54] - Moving C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\work\zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\zones_csv-file_31-05-2021_taxizone.csv
29/06/2021 17:52:13,785 - INFO - [FolderStructure.py:57] - Moved zones_csv-file_31-05-2021_taxizone.csv to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done
29/06/2021 17:52:13,785 - DEBUG - [FolderStructure.py:71] - Ending FolderStructure.Move_To_Directory with file having been moved to C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\data\done\zones_csv-file_31-05-2021_taxizone.csv.
29/06/2021 17:52:13,785 - INFO - [Workflow.py:35] - Running sa_to_rv flow.
29/06/2021 17:52:13,786 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:52:13,786 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_1_hubtrips.sql
29/06/2021 17:52:13,786 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql
29/06/2021 17:52:13,786 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,786 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql
29/06/2021 17:52:13,786 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_hubtrips_index;
		DROP INDEX IF EXISTS tpep_dropoff_hubtrips_index;
		
	END IF;
	
	INSERT INTO raw_vault.hubtrips(
		triphashkey, 
		loaddate, 
		recordsource, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		vendorid, 
		is_payment)
			
	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(
				CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
					TRIM(BOTH FROM rtf.vendorid), 
					CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 
				'sha256') 
			AS CHAR(64)) AS triphashkey,
		loaddaterecord, 
		recordsourceorigin, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(rtf.puzoneid AS INTEGER),
		CAST(rtf.dozoneid AS INTEGER),
		CAST(rtf.vendorid AS INTEGER),
		CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN 1 ELSE 0 END
			
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf
		
	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubtrips r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64)));
		
	CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:52:13,833 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,834 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_hubtrips_index;
		DROP INDEX IF EXISTS tpep_dropoff_hubtrips_index;
		
	END IF;
	
	INSERT INTO raw_vault.hubtrips(
		triphashkey, 
		loaddate, 
		recordsource, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		vendorid, 
		is_payment)
			
	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(
				CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
					TRIM(BOTH FROM rtf.vendorid), 
					CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 
				'sha256') 
			AS CHAR(64)) AS triphashkey,
		loaddaterecord, 
		recordsourceorigin, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(rtf.puzoneid AS INTEGER),
		CAST(rtf.dozoneid AS INTEGER),
		CAST(rtf.vendorid AS INTEGER),
		CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN 1 ELSE 0 END
			
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf
		
	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubtrips r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64)));
		
	CREATE INDEX IF NOT EXISTS tpep_pickup_hubtrips_index ON raw_vault.hubtrips(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_hubtrips_index ON raw_vault.hubtrips(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:52:13,834 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_1_hubtrips.sql script on database.
29/06/2021 17:52:13,834 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_2_sattrips.sql
29/06/2021 17:52:13,834 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql
29/06/2021 17:52:13,835 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,835 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql
29/06/2021 17:52:13,835 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_sattrips_csv_index;
		DROP INDEX IF EXISTS tpep_dropoff_sattrips_csv_index;
	
	END IF;

	INSERT INTO raw_vault.sattrips_csv (
		triphashkey, 
		loaddate, 
		recordsource, 
		passenger_count, 
		loadenddate, 
		trip_distance, 
		ratecodeid, 
		store_and_fwd_flag, 
		payment_type, 
		fare_amount, 
		extra, 
		mta_tax, 
		improvement_surcharge, 
		tip_amount, 
		tolls_amount, 
		total_amount, 
		vendorid, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		is_payment)

	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM LOWER(rtf.puzoneid)), TRIM(BOTH FROM LOWER(rtf.dozoneid)),
					TRIM(BOTH FROM LOWER(rtf.vendorid)), 
					CAST(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
					ELSE 0 END AS VARCHAR)),
			'sha256') 
		AS CHAR(64)) AS triphashkey,
		loaddaterecord, TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsourceorigin,
		CAST(TRIM(BOTH FROM LOWER(rtf.passenger_count)) AS INTEGER) AS passenger_count, 
		loadenddaterecord,
		CAST(TRIM(BOTH FROM LOWER(rtf.trip_distance)) AS DOUBLE PRECISION) AS trip_distance, 
		CAST(TRIM(BOTH FROM LOWER(rtf.ratecodeid)) AS INTEGER) AS ratecodeid, 
		TRIM(BOTH FROM LOWER(rtf.store_and_fwd_flag)) AS store_and_fwd_flag, 
		CAST(TRIM(BOTH FROM LOWER(rtf.payment_type)) AS INTEGER) AS payment_type,
		CAST(TRIM(BOTH FROM LOWER(rtf.fare_amount)) AS DOUBLE PRECISION) AS fare_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.extra)) AS DOUBLE PRECISION) AS extra,
		CAST(TRIM(BOTH FROM LOWER(rtf.mta_tax)) AS DOUBLE PRECISION) AS mta_tax, 
		CAST(TRIM(BOTH FROM LOWER(rtf.improvement_surcharge)) AS DOUBLE PRECISION) AS improvement_surcharge,
		CAST(TRIM(BOTH FROM LOWER(rtf.tip_amount)) AS DOUBLE PRECISION) AS tip_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.tolls_amount)) AS DOUBLE PRECISION) AS tolls_amount, 
		CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) AS total_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.vendorid)) AS INTEGER) AS vendorid, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime,
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(TRIM(BOTH FROM LOWER(rtf.puzoneid)) AS INTEGER) AS puzoneid, 
		CAST(TRIM(BOTH FROM LOWER(rtf.dozoneid)) AS INTEGER) AS dozoneid,
		(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
			ELSE 0 END) AS is_payment
	
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf

	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.sattrips_csv r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64))
			AND r.loaddate = loaddaterecord);

	CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:52:13,941 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,941 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	IF (SELECT count(*) FROM staging_area.rawtripsfile_csv) > 2e6 THEN
	
		DROP INDEX IF EXISTS tpep_pickup_sattrips_csv_index;
		DROP INDEX IF EXISTS tpep_dropoff_sattrips_csv_index;
	
	END IF;

	INSERT INTO raw_vault.sattrips_csv (
		triphashkey, 
		loaddate, 
		recordsource, 
		passenger_count, 
		loadenddate, 
		trip_distance, 
		ratecodeid, 
		store_and_fwd_flag, 
		payment_type, 
		fare_amount, 
		extra, 
		mta_tax, 
		improvement_surcharge, 
		tip_amount, 
		tolls_amount, 
		total_amount, 
		vendorid, 
		tpep_pickup_datetime, 
		tpep_dropoff_datetime, 
		puzoneid, 
		dozoneid, 
		is_payment)

	SELECT DISTINCT ON (triphashkey)
		CAST(
			DIGEST(CONCAT(CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
					CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
					TRIM(BOTH FROM LOWER(rtf.puzoneid)), TRIM(BOTH FROM LOWER(rtf.dozoneid)),
					TRIM(BOTH FROM LOWER(rtf.vendorid)), 
					CAST(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
					ELSE 0 END AS VARCHAR)),
			'sha256') 
		AS CHAR(64)) AS triphashkey,
		loaddaterecord, TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsourceorigin,
		CAST(TRIM(BOTH FROM LOWER(rtf.passenger_count)) AS INTEGER) AS passenger_count, 
		loadenddaterecord,
		CAST(TRIM(BOTH FROM LOWER(rtf.trip_distance)) AS DOUBLE PRECISION) AS trip_distance, 
		CAST(TRIM(BOTH FROM LOWER(rtf.ratecodeid)) AS INTEGER) AS ratecodeid, 
		TRIM(BOTH FROM LOWER(rtf.store_and_fwd_flag)) AS store_and_fwd_flag, 
		CAST(TRIM(BOTH FROM LOWER(rtf.payment_type)) AS INTEGER) AS payment_type,
		CAST(TRIM(BOTH FROM LOWER(rtf.fare_amount)) AS DOUBLE PRECISION) AS fare_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.extra)) AS DOUBLE PRECISION) AS extra,
		CAST(TRIM(BOTH FROM LOWER(rtf.mta_tax)) AS DOUBLE PRECISION) AS mta_tax, 
		CAST(TRIM(BOTH FROM LOWER(rtf.improvement_surcharge)) AS DOUBLE PRECISION) AS improvement_surcharge,
		CAST(TRIM(BOTH FROM LOWER(rtf.tip_amount)) AS DOUBLE PRECISION) AS tip_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.tolls_amount)) AS DOUBLE PRECISION) AS tolls_amount, 
		CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) AS total_amount,
		CAST(TRIM(BOTH FROM LOWER(rtf.vendorid)) AS INTEGER) AS vendorid, 
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_pickup_datetime,
		TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS tpep_dropoff_datetime, 
		CAST(TRIM(BOTH FROM LOWER(rtf.puzoneid)) AS INTEGER) AS puzoneid, 
		CAST(TRIM(BOTH FROM LOWER(rtf.dozoneid)) AS INTEGER) AS dozoneid,
		(CASE WHEN CAST(TRIM(BOTH FROM LOWER(rtf.total_amount)) AS DOUBLE PRECISION) >= 0 THEN 1 
			ELSE 0 END) AS is_payment
	
	FROM (SELECT DISTINCT * FROM staging_area.rawtripsfile_csv) AS rtf

	WHERE 
		rtf.tpep_pickup_datetime IS NOT NULL AND 
		rtf.tpep_dropoff_datetime IS NOT NULL AND 
		rtf.puzoneid IS NOT NULL AND 
		rtf.dozoneid IS NOT NULL AND 
		rtf.vendorid IS NOT NULL AND 
		rtf.total_amount IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.sattrips_csv r WHERE r.triphashkey = CAST(DIGEST(CONCAT(
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_pickup_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR),
			CAST(TO_TIMESTAMP(TRIM(BOTH FROM LOWER(rtf.tpep_dropoff_datetime)), 'MM/DD/YYYY HH:MI:SS AM') AS VARCHAR), 
			TRIM(BOTH FROM rtf.puzoneid), TRIM(BOTH FROM rtf.dozoneid),
			TRIM(BOTH FROM rtf.vendorid), 
			CASE WHEN CAST(rtf.total_amount AS DOUBLE PRECISION) >= 0 THEN '1' ELSE '0' END), 'sha256') AS CHAR(64))
			AND r.loaddate = loaddaterecord);

	CREATE INDEX IF NOT EXISTS tpep_pickup_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_pickup_datetime);
	CREATE INDEX IF NOT EXISTS tpep_dropoff_sattrips_csv_index ON raw_vault.sattrips_csv(tpep_dropoff_datetime);
	
END $$; arguments.
29/06/2021 17:52:13,941 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_2_sattrips.sql script on database.
29/06/2021 17:52:13,942 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_3_update_sattrips.sql
29/06/2021 17:52:13,942 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql
29/06/2021 17:52:13,942 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,942 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql
29/06/2021 17:52:13,942 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
									
	UPDATE raw_vault.sattrips_csv st 
	SET loadenddate = loaddaterecord - INTERVAL '1s' 
	WHERE 
		st.loadenddate > loaddaterecord AND 
		st.loaddate < loaddaterecord AND 
		st.triphashkey IN (SELECT triphashkey 
								FROM raw_vault.sattrips_csv 
								WHERE
									triphashkey = st.triphashkey AND 
									loaddate = loaddaterecord);

	TRUNCATE staging_area.rawtripsfile_csv;
								
END $$;
 arguments.
29/06/2021 17:52:13,986 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,987 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
									
	UPDATE raw_vault.sattrips_csv st 
	SET loadenddate = loaddaterecord - INTERVAL '1s' 
	WHERE 
		st.loadenddate > loaddaterecord AND 
		st.loaddate < loaddaterecord AND 
		st.triphashkey IN (SELECT triphashkey 
								FROM raw_vault.sattrips_csv 
								WHERE
									triphashkey = st.triphashkey AND 
									loaddate = loaddaterecord);

	TRUNCATE staging_area.rawtripsfile_csv;
								
END $$;
 arguments.
29/06/2021 17:52:13,987 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_3_update_sattrips.sql script on database.
29/06/2021 17:52:13,987 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_4_hubzones.sql
29/06/2021 17:52:13,988 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql
29/06/2021 17:52:13,988 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,988 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql
29/06/2021 17:52:13,988 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.hubzones (
		zonenamehashkey, 
		"zone", 
		borough, 
		service_zone,
		loaddate, 
		recordsource
		)

	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') 
			AS CHAR(64)) AS zonenamehashkey, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone",
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough,
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone,
		loaddaterecord,
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource 
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf

	WHERE 
		rtf."zone" IS NOT NULL AND
		rtf.borough IS NOT NULL AND
		rtf.service_zone IS NOT NULL AND
		NOT EXISTS (SELECT * FROM raw_vault.hubzones h WHERE h.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")),
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') AS CHAR(64)));

END $$; arguments.
29/06/2021 17:52:13,992 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:13,992 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.hubzones (
		zonenamehashkey, 
		"zone", 
		borough, 
		service_zone,
		loaddate, 
		recordsource
		)

	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') 
			AS CHAR(64)) AS zonenamehashkey, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone",
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough,
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone,
		loaddaterecord,
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource 
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf

	WHERE 
		rtf."zone" IS NOT NULL AND
		rtf.borough IS NOT NULL AND
		rtf.service_zone IS NOT NULL AND
		NOT EXISTS (SELECT * FROM raw_vault.hubzones h WHERE h.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")),
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') AS CHAR(64)));

END $$; arguments.
29/06/2021 17:52:13,992 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_4_hubzones.sql script on database.
29/06/2021 17:52:13,993 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_5_satzones.sql
29/06/2021 17:52:13,993 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql
29/06/2021 17:52:13,993 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:13,993 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql
29/06/2021 17:52:13,993 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satzones_csv(
		zonenamehashkey, 
		loaddate, 
		borough, 
		"zone", 
		service_zone, 
		loadenddate, 
		recordsource, 
		zoneid)
		
	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') as CHAR(64)) AS zonenamehashkey, 
		loaddaterecord, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone", 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone, 
		loadenddaterecord, 
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource, 
		CAST(TRIM(BOTH FROM LOWER(rtf.zoneid)) AS INTEGER) AS zoneid
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf
	
	WHERE 
		rtf.zoneid IS NOT NULL AND 
		rtf.borough IS NOT NULL AND 
		rtf."zone" IS NOT NULL AND 
		rtf.service_zone IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satzones_csv s WHERE s.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), 
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256')
			AS CHAR(64))
			AND s.loaddate = loaddaterecord);
	
END $$; arguments.
29/06/2021 17:52:14,2 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,2 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satzones_csv(
		zonenamehashkey, 
		loaddate, 
		borough, 
		"zone", 
		service_zone, 
		loadenddate, 
		recordsource, 
		zoneid)
		
	SELECT DISTINCT ON (zonenamehashkey)
		CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), TRIM(BOTH FROM LOWER(rtf.borough)), 
			TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256') as CHAR(64)) AS zonenamehashkey, 
		loaddaterecord, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.borough))) AS borough, 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf."zone"))) AS "zone", 
		TRIM(BOTH FROM TRIM(both '"' FROM LOWER(rtf.service_zone))) AS service_zone, 
		loadenddaterecord, 
		TRIM(BOTH FROM LOWER(recordsourceorigin)) AS recordsource, 
		CAST(TRIM(BOTH FROM LOWER(rtf.zoneid)) AS INTEGER) AS zoneid
	
	FROM (SELECT DISTINCT * FROM staging_area.rawzonesfile_csv) AS rtf
	
	WHERE 
		rtf.zoneid IS NOT NULL AND 
		rtf.borough IS NOT NULL AND 
		rtf."zone" IS NOT NULL AND 
		rtf.service_zone IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satzones_csv s WHERE s.zonenamehashkey = CAST(DIGEST(CONCAT(TRIM(BOTH FROM LOWER(rtf."zone")), 
			TRIM(BOTH FROM LOWER(rtf.borough)), TRIM(BOTH FROM LOWER(rtf.service_zone))),'sha256')
			AS CHAR(64))
			AND s.loaddate = loaddaterecord);
	
END $$; arguments.
29/06/2021 17:52:14,2 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_5_satzones.sql script on database.
29/06/2021 17:52:14,2 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_6_update_satzones.sql
29/06/2021 17:52:14,3 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql
29/06/2021 17:52:14,3 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,3 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql
29/06/2021 17:52:14,3 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	UPDATE raw_vault.satzones_csv sl
		SET loadenddate = loaddaterecord - INTERVAL '1s'
		WHERE 
			sl.loadenddate > loaddaterecord AND 
			sl.loaddate < loaddaterecord AND 
			sl.zonenamehashkey IN (SELECT zonenamehashkey 
										FROM raw_vault.satzones_csv 
										WHERE 
											zonenamehashkey = sl.zonenamehashkey AND 
											loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawzonesfile_csv;
									
END $$; arguments.
29/06/2021 17:52:14,15 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,15 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	UPDATE raw_vault.satzones_csv sl
		SET loadenddate = loaddaterecord - INTERVAL '1s'
		WHERE 
			sl.loadenddate > loaddaterecord AND 
			sl.loaddate < loaddaterecord AND 
			sl.zonenamehashkey IN (SELECT zonenamehashkey 
										FROM raw_vault.satzones_csv 
										WHERE 
											zonenamehashkey = sl.zonenamehashkey AND 
											loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawzonesfile_csv;
									
END $$; arguments.
29/06/2021 17:52:14,16 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_6_update_satzones.sql script on database.
29/06/2021 17:52:14,16 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:52:14,16 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:52:14,17 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,17 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql
29/06/2021 17:52:14,17 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

--

	INSERT INTO raw_vault.hubratecodeids(
		ratecodenamehashkey,
		ratecodename,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
					FROM raw_vault.hubratecodeids hrc 
					WHERE 
						hrc.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)));
						
END $$; arguments.
29/06/2021 17:52:14,18 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,19 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

--

	INSERT INTO raw_vault.hubratecodeids(
		ratecodenamehashkey,
		ratecodename,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
					FROM raw_vault.hubratecodeids hrc 
					WHERE 
						hrc.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)));
						
END $$; arguments.
29/06/2021 17:52:14,19 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_7_hubratecodeids.sql script on database.
29/06/2021 17:52:14,20 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_8_satratecodeids.sql
29/06/2021 17:52:14,20 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql
29/06/2021 17:52:14,20 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,20 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql
29/06/2021 17:52:14,20 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satratecodeids_csv(
		ratecodenamehashkey,
		ratecodeid,
		ratecodename,
		loaddate,
		loadenddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		CAST(rrcf.ratecodeid AS INTEGER),
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satratecodeids_csv src 
						WHERE 
							src.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256')
							AS CHAR(64))
							AND src.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:52:14,23 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,23 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satratecodeids_csv(
		ratecodenamehashkey,
		ratecodeid,
		ratecodename,
		loaddate,
		loadenddate,
		recordsource)
		
	SELECT DISTINCT ON (ratecodenamehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256') AS CHAR(64)) AS ratecodenamehashkey,
		CAST(rrcf.ratecodeid AS INTEGER),
		TRIM(BOTH FROM LOWER(rrcf.ratecodename)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawratecodeidsfile_csv) AS rrcf
	
	WHERE 
		rrcf.ratecodeid IS NOT NULL AND 
		rrcf.ratecodename IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satratecodeids_csv src 
						WHERE 
							src.ratecodenamehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rrcf.ratecodename)),'sha256')
							AS CHAR(64))
							AND src.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:52:14,23 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_8_satratecodeids.sql script on database.
29/06/2021 17:52:14,23 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:52:14,23 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:52:14,23 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,24 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql
29/06/2021 17:52:14,24 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

	UPDATE raw_vault.satratecodeids_csv src 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		src.loadenddate > loaddaterecord AND 
		src.loaddate < loaddaterecord AND 
		src.ratecodenamehashkey IN (SELECT ratecodenamehashkey 
								FROM raw_vault.satratecodeids_csv 
								WHERE
									ratecodenamehashkey = src.ratecodenamehashkey AND 
									loaddate = loaddaterecord);
								

	
	TRUNCATE staging_area.rawratecodeidsfile_csv;

END $$; arguments.
29/06/2021 17:52:14,29 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,30 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

	UPDATE raw_vault.satratecodeids_csv src 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		src.loadenddate > loaddaterecord AND 
		src.loaddate < loaddaterecord AND 
		src.ratecodenamehashkey IN (SELECT ratecodenamehashkey 
								FROM raw_vault.satratecodeids_csv 
								WHERE
									ratecodenamehashkey = src.ratecodenamehashkey AND 
									loaddate = loaddaterecord);
								

	
	TRUNCATE staging_area.rawratecodeidsfile_csv;

END $$; arguments.
29/06/2021 17:52:14,30 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_9_update_satratecodeids.sql script on database.
29/06/2021 17:52:14,31 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:52:14,31 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:52:14,31 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,31 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql
29/06/2021 17:52:14,31 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubpaymenttypes(
		paymenttypehashkey,
		paymenttypename,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubpaymenttypes hpt 
						WHERE hpt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
															'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:52:14,32 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,33 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubpaymenttypes(
		paymenttypehashkey,
		paymenttypename,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.hubpaymenttypes hpt 
						WHERE hpt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
															'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:52:14,33 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_10_hubpaymenttypes.sql script on database.
29/06/2021 17:52:14,34 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:52:14,34 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:52:14,34 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,34 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql
29/06/2021 17:52:14,34 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satpaymenttypes_csv(
		paymenttypehashkey,
		paymenttypeid,
		paymenttypename,
		loaddate,
		loadenddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		CAST(rptf.paymenttype_id AS INTEGER),
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE 
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satpaymenttypes_csv spt 
		WHERE spt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64))
			AND spt.loaddate = loaddaterecord);
			
END $$; arguments.
29/06/2021 17:52:14,37 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,38 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.satpaymenttypes_csv(
		paymenttypehashkey,
		paymenttypeid,
		paymenttypename,
		loaddate,
		loadenddate,
		recordsource)
	
	SELECT DISTINCT ON (paymenttypehashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64)) AS paymenttypehashkey,
		CAST(rptf.paymenttype_id AS INTEGER),
		TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),
		loaddaterecord,
		loadenddaterecord,
		recordsourceorigin
	
	FROM (SELECT DISTINCT * FROM staging_area.rawpaymenttypesfile_csv) AS rptf
	
	WHERE 
		rptf.paymenttype_id IS NOT NULL AND 
		rptf.paymenttype_name IS NOT NULL AND 
		NOT EXISTS (SELECT * FROM raw_vault.satpaymenttypes_csv spt 
		WHERE spt.paymenttypehashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rptf.paymenttype_name)),'sha256') AS CHAR(64))
			AND spt.loaddate = loaddaterecord);
			
END $$; arguments.
29/06/2021 17:52:14,38 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_11_satpaymenttypes.sql script on database.
29/06/2021 17:52:14,38 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:52:14,38 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:52:14,39 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,39 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql
29/06/2021 17:52:14,39 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
								
	UPDATE raw_vault.satpaymenttypes_csv spt 
	SET loadenddate = loaddaterecord - INTERVAL '1s'   
	WHERE 
		spt.loadenddate > loaddaterecord AND 
		spt.loaddate < loaddaterecord AND 
		spt.paymenttypehashkey IN (SELECT paymenttypehashkey 
								FROM raw_vault.satpaymenttypes_csv 
								WHERE
									paymenttypehashkey = spt.paymenttypehashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawpaymenttypesfile_csv;

END $$; arguments.
29/06/2021 17:52:14,43 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,44 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					
								
	UPDATE raw_vault.satpaymenttypes_csv spt 
	SET loadenddate = loaddaterecord - INTERVAL '1s'   
	WHERE 
		spt.loadenddate > loaddaterecord AND 
		spt.loaddate < loaddaterecord AND 
		spt.paymenttypehashkey IN (SELECT paymenttypehashkey 
								FROM raw_vault.satpaymenttypes_csv 
								WHERE
									paymenttypehashkey = spt.paymenttypehashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawpaymenttypesfile_csv;

END $$; arguments.
29/06/2021 17:52:14,44 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_12_update_satpaymenttypes.sql script on database.
29/06/2021 17:52:14,45 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_13_hubvendors.sql
29/06/2021 17:52:14,45 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql
29/06/2021 17:52:14,45 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,45 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql
29/06/2021 17:52:14,45 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubvendors(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.hubvendors hv 
						WHERE 
							hv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)));
							
END $$; arguments.
29/06/2021 17:52:14,47 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,48 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.hubvendors(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.hubvendors hv 
						WHERE 
							hv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)));
							
END $$; arguments.
29/06/2021 17:52:14,48 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_13_hubvendors.sql script on database.
29/06/2021 17:52:14,49 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_14_satvendors.sql
29/06/2021 17:52:14,49 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql
29/06/2021 17:52:14,49 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,49 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql
29/06/2021 17:52:14,49 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satvendors_csv(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource,
		vendorid,
		loadenddate)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin,
		CAST(rvf.vendorid AS INTEGER),
		loadenddaterecord
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satvendors_csv sv 
						WHERE 
							sv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64))
							AND sv.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:52:14,52 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,52 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN

	INSERT INTO raw_vault.satvendors_csv(
		vendorhashkey,
		vendorname,
		loaddate,
		recordsource,
		vendorid,
		loadenddate)
	
	SELECT DISTINCT ON (vendorhashkey)
		CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64)) AS vendorhashkey,
		TRIM(BOTH FROM LOWER(rvf.vendorname)),
		loaddaterecord,
		recordsourceorigin,
		CAST(rvf.vendorid AS INTEGER),
		loadenddaterecord
		
	FROM (SELECT DISTINCT * FROM staging_area.rawvendorsfile_csv) AS rvf
	
	WHERE 
		rvf.vendorname IS NOT NULL AND 
		rvf.vendorid IS NOT NULL AND 
		NOT EXISTS (SELECT * 
						FROM raw_vault.satvendors_csv sv 
						WHERE 
							sv.vendorhashkey = CAST(DIGEST(TRIM(BOTH FROM LOWER(rvf.vendorname)),'sha256') AS CHAR(64))
							AND sv.loaddate = loaddaterecord);
							
END $$; arguments.
29/06/2021 17:52:14,53 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_14_satvendors.sql script on database.
29/06/2021 17:52:14,53 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_15_update_satvendors.sql
29/06/2021 17:52:14,53 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql
29/06/2021 17:52:14,53 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,53 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql
29/06/2021 17:52:14,54 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

								
	UPDATE raw_vault.satvendors_csv sv 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		sv.loadenddate > loaddaterecord AND 
		sv.loaddate < loaddaterecord AND 
		sv.vendorhashkey IN (SELECT vendorhashkey 
								FROM raw_vault.satvendors_csv 
								WHERE
									vendorhashkey = sv.vendorhashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawvendorsfile_csv;
								
END $$; arguments.
29/06/2021 17:52:14,58 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,59 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('csv'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN					

								
	UPDATE raw_vault.satvendors_csv sv 
	SET loadenddate = loaddaterecord - INTERVAL '1s'
	WHERE 
		sv.loadenddate > loaddaterecord AND 
		sv.loaddate < loaddaterecord AND 
		sv.vendorhashkey IN (SELECT vendorhashkey 
								FROM raw_vault.satvendors_csv 
								WHERE
									vendorhashkey = sv.vendorhashkey AND 
									loaddate = loaddaterecord);
									
	TRUNCATE staging_area.rawvendorsfile_csv;
								
END $$; arguments.
29/06/2021 17:52:14,59 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_15_update_satvendors.sql script on database.
29/06/2021 17:52:14,59 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/raw_vault_load_16_linktrips.sql
29/06/2021 17:52:14,59 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql
29/06/2021 17:52:14,59 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,59 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql
29/06/2021 17:52:14,60 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('system'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.linktrips(
		linktriphashkey,
		triphashkey,
		puzonenamehashkey,
		dozonenamehashkey,
		vendorhashkey,
		ratecodenamehashkey,
		paymenttypehashkey,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (linktriphashkey)
		CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
			pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
			src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)) AS linktriphashkey,
		st.triphashkey,
		pusz.zonenamehashkey,
		dosz.zonenamehashkey,
		sv.vendorhashkey,
		src.ratecodenamehashkey,
		spt.paymenttypehashkey,
		loaddaterecord, 
		recordsourceorigin
		
	FROM raw_vault.sattrips_csv st
		JOIN raw_vault.satzones_csv pusz ON st.puzoneid = pusz.zoneid AND loaddaterecord < pusz.loadenddate AND loaddaterecord >= pusz.loaddate
		JOIN raw_vault.satzones_csv dosz ON st.dozoneid = dosz.zoneid AND loaddaterecord < dosz.loadenddate AND loaddaterecord >= dosz.loaddate
		JOIN raw_vault.satvendors_csv sv ON st.vendorid = sv.vendorid AND loaddaterecord < sv.loadenddate AND loaddaterecord >= sv.loaddate
		JOIN raw_vault.satratecodeids_csv src ON st.ratecodeid = src.ratecodeid AND loaddaterecord < src.loadenddate AND loaddaterecord >= src.loaddate
		JOIN raw_vault.satpaymenttypes_csv spt ON st.payment_type = spt.paymenttypeid AND loaddaterecord < spt.loadenddate AND loaddaterecord >= spt.loaddate

	WHERE 
		st.triphashkey IS NOT NULL AND
		pusz.zonenamehashkey IS NOT NULL AND 
		dosz.zonenamehashkey IS NOT NULL AND
		sv.vendorhashkey IS NOT NULL AND
		src.ratecodenamehashkey IS NOT NULL AND
		spt.paymenttypehashkey IS NOT NULL AND
		NOT EXISTS (SELECT * 
						FROM raw_vault.linktrips l 
						WHERE 
							l.linktriphashkey = CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
													pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
													src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:52:14,105 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,105 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	loaddaterecord TIMESTAMP := CAST('2021-06-29 17:52:13' AS TIMESTAMP);
	recordsourceorigin VARCHAR := TRIM(BOTH FROM LOWER('system'));
	loadenddaterecord TIMESTAMP := CAST('9999-12-30 00:00:00.000' AS TIMESTAMP);

BEGIN
	
	INSERT INTO raw_vault.linktrips(
		linktriphashkey,
		triphashkey,
		puzonenamehashkey,
		dozonenamehashkey,
		vendorhashkey,
		ratecodenamehashkey,
		paymenttypehashkey,
		loaddate,
		recordsource)
		
	SELECT DISTINCT ON (linktriphashkey)
		CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
			pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
			src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)) AS linktriphashkey,
		st.triphashkey,
		pusz.zonenamehashkey,
		dosz.zonenamehashkey,
		sv.vendorhashkey,
		src.ratecodenamehashkey,
		spt.paymenttypehashkey,
		loaddaterecord, 
		recordsourceorigin
		
	FROM raw_vault.sattrips_csv st
		JOIN raw_vault.satzones_csv pusz ON st.puzoneid = pusz.zoneid AND loaddaterecord < pusz.loadenddate AND loaddaterecord >= pusz.loaddate
		JOIN raw_vault.satzones_csv dosz ON st.dozoneid = dosz.zoneid AND loaddaterecord < dosz.loadenddate AND loaddaterecord >= dosz.loaddate
		JOIN raw_vault.satvendors_csv sv ON st.vendorid = sv.vendorid AND loaddaterecord < sv.loadenddate AND loaddaterecord >= sv.loaddate
		JOIN raw_vault.satratecodeids_csv src ON st.ratecodeid = src.ratecodeid AND loaddaterecord < src.loadenddate AND loaddaterecord >= src.loaddate
		JOIN raw_vault.satpaymenttypes_csv spt ON st.payment_type = spt.paymenttypeid AND loaddaterecord < spt.loadenddate AND loaddaterecord >= spt.loaddate

	WHERE 
		st.triphashkey IS NOT NULL AND
		pusz.zonenamehashkey IS NOT NULL AND 
		dosz.zonenamehashkey IS NOT NULL AND
		sv.vendorhashkey IS NOT NULL AND
		src.ratecodenamehashkey IS NOT NULL AND
		spt.paymenttypehashkey IS NOT NULL AND
		NOT EXISTS (SELECT * 
						FROM raw_vault.linktrips l 
						WHERE 
							l.linktriphashkey = CAST(DIGEST(CONCAT(st.triphashkey, pusz.zonenamehashkey, dosz.zonenamehashkey, 
													pusz.zonenamehashkey, dosz.zonenamehashkey, sv.vendorhashkey, 
													src.ratecodenamehashkey, spt.paymenttypehashkey), 'sha256') AS CHAR(64)));
	
END $$; arguments.
29/06/2021 17:52:14,105 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\raw_vault_load_16_linktrips.sql script on database.
29/06/2021 17:52:14,106 - INFO - [Workflow.py:35] - Running rv_to_bv flow.
29/06/2021 17:52:14,106 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:52:14,106 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_1_schema_structure.sql
29/06/2021 17:52:14,106 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql
29/06/2021 17:52:14,107 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,107 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql
29/06/2021 17:52:14,107 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

    IF (SELECT count(*) FROM raw_vault.sattrips_csv st WHERE st.loadenddate > time_now) >= 0 THEN

        DROP SCHEMA IF EXISTS business_vault CASCADE;
        
    END IF;

    CREATE SCHEMA IF NOT EXISTS business_vault;
    CREATE EXTENSION IF NOT EXISTS pgcrypto;
    COMMIT;

END $$; arguments.
29/06/2021 17:52:14,127 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,128 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

    IF (SELECT count(*) FROM raw_vault.sattrips_csv st WHERE st.loadenddate > time_now) >= 0 THEN

        DROP SCHEMA IF EXISTS business_vault CASCADE;
        
    END IF;

    CREATE SCHEMA IF NOT EXISTS business_vault;
    CREATE EXTENSION IF NOT EXISTS pgcrypto;
    COMMIT;

END $$; arguments.
29/06/2021 17:52:14,128 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_1_schema_structure.sql script on database.
29/06/2021 17:52:14,128 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_2_timedim.sql
29/06/2021 17:52:14,129 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql
29/06/2021 17:52:14,129 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,129 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql
29/06/2021 17:52:14,129 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_begin TIMESTAMP := CAST('2018-01-01' AS TIMESTAMP);
	time_end TIMESTAMP := CAST('2019-01-01' AS TIMESTAMP);

BEGIN

	IF NOT EXISTS (SELECT FROM pg_catalog.pg_tables WHERE schemaname = 'business_vault' AND tablename = 'timedim') THEN 

	CREATE TABLE IF NOT EXISTS business_vault.timedim(
		timeid SERIAL PRIMARY KEY,
		"hour" INTEGER,
		"day" INTEGER,
		timestring TIMESTAMP);

	COMMIT;

	INSERT INTO business_vault.timedim(
		"hour", 
		"day", 
		timestring)
		
	SELECT
		EXTRACT(HOUR FROM time_series),
		EXTRACT(DOY FROM time_series),
		time_series
		
	FROM generate_series(
		time_begin,
		time_end,
		CAST('1 hour' AS INTERVAL)
		) AS time_series;
		
	DROP INDEX IF EXISTS timestring_dim_index;
	DROP INDEX IF EXISTS timeid_dim_index;
	DROP INDEX IF EXISTS hour_dim_index;
	DROP INDEX IF EXISTS day_dim_index;
	
	CREATE INDEX IF NOT EXISTS timestring_dim_index ON business_vault.timedim(timestring);
	CREATE INDEX IF NOT EXISTS timeid_dim_index ON business_vault.timedim(timeid);
	CREATE INDEX IF NOT EXISTS hour_dim_index ON business_vault.timedim("hour");
	CREATE INDEX IF NOT EXISTS day_dim_index ON business_vault.timedim("day");

	END IF;
	
END $$; arguments.
29/06/2021 17:52:14,189 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,189 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_begin TIMESTAMP := CAST('2018-01-01' AS TIMESTAMP);
	time_end TIMESTAMP := CAST('2019-01-01' AS TIMESTAMP);

BEGIN

	IF NOT EXISTS (SELECT FROM pg_catalog.pg_tables WHERE schemaname = 'business_vault' AND tablename = 'timedim') THEN 

	CREATE TABLE IF NOT EXISTS business_vault.timedim(
		timeid SERIAL PRIMARY KEY,
		"hour" INTEGER,
		"day" INTEGER,
		timestring TIMESTAMP);

	COMMIT;

	INSERT INTO business_vault.timedim(
		"hour", 
		"day", 
		timestring)
		
	SELECT
		EXTRACT(HOUR FROM time_series),
		EXTRACT(DOY FROM time_series),
		time_series
		
	FROM generate_series(
		time_begin,
		time_end,
		CAST('1 hour' AS INTERVAL)
		) AS time_series;
		
	DROP INDEX IF EXISTS timestring_dim_index;
	DROP INDEX IF EXISTS timeid_dim_index;
	DROP INDEX IF EXISTS hour_dim_index;
	DROP INDEX IF EXISTS day_dim_index;
	
	CREATE INDEX IF NOT EXISTS timestring_dim_index ON business_vault.timedim(timestring);
	CREATE INDEX IF NOT EXISTS timeid_dim_index ON business_vault.timedim(timeid);
	CREATE INDEX IF NOT EXISTS hour_dim_index ON business_vault.timedim("hour");
	CREATE INDEX IF NOT EXISTS day_dim_index ON business_vault.timedim("day");

	END IF;
	
END $$; arguments.
29/06/2021 17:52:14,190 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_2_timedim.sql script on database.
29/06/2021 17:52:14,190 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_3_vendordim.sql
29/06/2021 17:52:14,191 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql
29/06/2021 17:52:14,191 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,191 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql
29/06/2021 17:52:14,191 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.vendordim(
		vendorid INTEGER PRIMARY KEY, 
		vendorname VARCHAR);
	
CREATE INDEX IF NOT EXISTS vendorid_dim_index ON business_vault.vendordim(vendorid); arguments.
29/06/2021 17:52:14,200 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,201 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.vendordim(
		vendorid INTEGER PRIMARY KEY, 
		vendorname VARCHAR);
	
CREATE INDEX IF NOT EXISTS vendorid_dim_index ON business_vault.vendordim(vendorid); arguments.
29/06/2021 17:52:14,201 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_3_vendordim.sql script on database.
29/06/2021 17:52:14,201 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_4_payment_typedim.sql
29/06/2021 17:52:14,201 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql
29/06/2021 17:52:14,202 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,202 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql
29/06/2021 17:52:14,202 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_typedim(
	payment_typeid INTEGER PRIMARY KEY, 
	payment_type_name VARCHAR);
		
CREATE INDEX IF NOT EXISTS payment_type_dim_index ON business_vault.payment_typedim(payment_typeid);
 arguments.
29/06/2021 17:52:14,210 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,210 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_typedim(
	payment_typeid INTEGER PRIMARY KEY, 
	payment_type_name VARCHAR);
		
CREATE INDEX IF NOT EXISTS payment_type_dim_index ON business_vault.payment_typedim(payment_typeid);
 arguments.
29/06/2021 17:52:14,210 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_4_payment_typedim.sql script on database.
29/06/2021 17:52:14,211 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_5_ratecodedim.sql
29/06/2021 17:52:14,211 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql
29/06/2021 17:52:14,211 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,211 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql
29/06/2021 17:52:14,211 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.ratecodedim(
	ratecodeid INTEGER PRIMARY KEY, 
	ratecodename VARCHAR);
	
CREATE INDEX IF NOT EXISTS ratecode_dim_index ON business_vault.ratecodedim(ratecodeid);
 arguments.
29/06/2021 17:52:14,220 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,220 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.ratecodedim(
	ratecodeid INTEGER PRIMARY KEY, 
	ratecodename VARCHAR);
	
CREATE INDEX IF NOT EXISTS ratecode_dim_index ON business_vault.ratecodedim(ratecodeid);
 arguments.
29/06/2021 17:52:14,221 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_5_ratecodedim.sql script on database.
29/06/2021 17:52:14,221 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_6_boroughdim.sql
29/06/2021 17:52:14,221 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql
29/06/2021 17:52:14,222 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,222 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql
29/06/2021 17:52:14,222 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.boroughdim(
	boroughid SERIAL PRIMARY KEY, 
	boroughname VARCHAR);

CREATE INDEX IF NOT EXISTS boroughdim_index ON business_vault.boroughdim(boroughid);
 arguments.
29/06/2021 17:52:14,231 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,232 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.boroughdim(
	boroughid SERIAL PRIMARY KEY, 
	boroughname VARCHAR);

CREATE INDEX IF NOT EXISTS boroughdim_index ON business_vault.boroughdim(boroughid);
 arguments.
29/06/2021 17:52:14,232 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_6_boroughdim.sql script on database.
29/06/2021 17:52:14,232 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_7_service_zonedim.sql
29/06/2021 17:52:14,233 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql
29/06/2021 17:52:14,233 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,233 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql
29/06/2021 17:52:14,233 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zonedim(
	service_zoneid SERIAL PRIMARY KEY, 
	service_zonename VARCHAR);

CREATE INDEX IF NOT EXISTS service_zonedim_index ON business_vault.service_zonedim(service_zoneid); arguments.
29/06/2021 17:52:14,242 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,243 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zonedim(
	service_zoneid SERIAL PRIMARY KEY, 
	service_zonename VARCHAR);

CREATE INDEX IF NOT EXISTS service_zonedim_index ON business_vault.service_zonedim(service_zoneid); arguments.
29/06/2021 17:52:14,243 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_7_service_zonedim.sql script on database.
29/06/2021 17:52:14,243 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:52:14,243 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:52:14,243 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,244 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql
29/06/2021 17:52:14,244 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zone_borough_correspondance(
	correspondanceid SERIAL PRIMARY KEY, 
	service_zoneid INTEGER, 
	boroughid INTEGER
	);

CREATE INDEX IF NOT EXISTS correspondanceid_dim_index ON business_vault.service_zone_borough_correspondance(correspondanceid);
CREATE INDEX IF NOT EXISTS service_zoneid_dim_index ON business_vault.service_zone_borough_correspondance(service_zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.service_zone_borough_correspondance(boroughid);
 arguments.
29/06/2021 17:52:14,258 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,258 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.service_zone_borough_correspondance(
	correspondanceid SERIAL PRIMARY KEY, 
	service_zoneid INTEGER, 
	boroughid INTEGER
	);

CREATE INDEX IF NOT EXISTS correspondanceid_dim_index ON business_vault.service_zone_borough_correspondance(correspondanceid);
CREATE INDEX IF NOT EXISTS service_zoneid_dim_index ON business_vault.service_zone_borough_correspondance(service_zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.service_zone_borough_correspondance(boroughid);
 arguments.
29/06/2021 17:52:14,259 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_8_service_zone_borough_correspondance.sql script on database.
29/06/2021 17:52:14,259 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_9_zonedim.sql
29/06/2021 17:52:14,259 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql
29/06/2021 17:52:14,259 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,259 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql
29/06/2021 17:52:14,260 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.zonedim(
	zoneid INTEGER PRIMARY KEY, 
	boroughid INTEGER, 
	zonename VARCHAR
	);

CREATE INDEX IF NOT EXISTS zoneid_dim_index ON business_vault.zonedim(zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.zonedim(boroughid);
 arguments.
29/06/2021 17:52:14,269 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,269 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.zonedim(
	zoneid INTEGER PRIMARY KEY, 
	boroughid INTEGER, 
	zonename VARCHAR
	);

CREATE INDEX IF NOT EXISTS zoneid_dim_index ON business_vault.zonedim(zoneid);
CREATE INDEX IF NOT EXISTS boroughid_dim_index ON business_vault.zonedim(boroughid);
 arguments.
29/06/2021 17:52:14,269 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_9_zonedim.sql script on database.
29/06/2021 17:52:14,270 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_10_payment_naturedim.sql
29/06/2021 17:52:14,270 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql
29/06/2021 17:52:14,270 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,270 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql
29/06/2021 17:52:14,270 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_naturedim(
	payment_natureid INTEGER PRIMARY KEY,
	payment_nature_name VARCHAR);

INSERT INTO business_vault.payment_naturedim(payment_natureid, payment_nature_name)
VALUES
(0, 'Refund'),
(1, 'Payment')
ON CONFLICT (payment_natureid)
DO NOTHING;

CREATE INDEX IF NOT EXISTS payment_nature_dim_index ON business_vault.payment_naturedim(payment_natureid);
 arguments.
29/06/2021 17:52:14,279 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,280 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE IF NOT EXISTS business_vault.payment_naturedim(
	payment_natureid INTEGER PRIMARY KEY,
	payment_nature_name VARCHAR);

INSERT INTO business_vault.payment_naturedim(payment_natureid, payment_nature_name)
VALUES
(0, 'Refund'),
(1, 'Payment')
ON CONFLICT (payment_natureid)
DO NOTHING;

CREATE INDEX IF NOT EXISTS payment_nature_dim_index ON business_vault.payment_naturedim(payment_natureid);
 arguments.
29/06/2021 17:52:14,280 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_10_payment_naturedim.sql script on database.
29/06/2021 17:52:14,280 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_create_11_tripfacts.sql
29/06/2021 17:52:14,280 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql
29/06/2021 17:52:14,280 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,280 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql
29/06/2021 17:52:14,281 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, CREATE TABLE IF NOT EXISTS business_vault.tripfacts(
		triphashkey CHAR(64),
		pickuptimeid INTEGER, 
		dropofftimeid INTEGER, 
		puzoneid INTEGER, 
		dozoneid INTEGER, 
		vendorid INTEGER, 
		payment_typeid INTEGER, 
		ratecodeid INTEGER,
		passengercount INTEGER,
		total_amount DOUBLE PRECISION,
		tip_amount DOUBLE PRECISION,
		trip_distance DOUBLE PRECISION,
		is_payment INTEGER,
		trip_time INTERVAL,
		PRIMARY KEY (
			triphashkey,
			pickuptimeid, 
			dropofftimeid, 
			puzoneid, 
			dozoneid, 
			vendorid,
			ratecodeid,
			payment_typeid
			)
); arguments.
29/06/2021 17:52:14,285 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:14,285 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, CREATE TABLE IF NOT EXISTS business_vault.tripfacts(
		triphashkey CHAR(64),
		pickuptimeid INTEGER, 
		dropofftimeid INTEGER, 
		puzoneid INTEGER, 
		dozoneid INTEGER, 
		vendorid INTEGER, 
		payment_typeid INTEGER, 
		ratecodeid INTEGER,
		passengercount INTEGER,
		total_amount DOUBLE PRECISION,
		tip_amount DOUBLE PRECISION,
		trip_distance DOUBLE PRECISION,
		is_payment INTEGER,
		trip_time INTERVAL,
		PRIMARY KEY (
			triphashkey,
			pickuptimeid, 
			dropofftimeid, 
			puzoneid, 
			dozoneid, 
			vendorid,
			ratecodeid,
			payment_typeid
			)
); arguments.
29/06/2021 17:52:14,285 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_create_11_tripfacts.sql script on database.
29/06/2021 17:52:14,286 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_1_tripfacts.sql
29/06/2021 17:52:14,286 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql
29/06/2021 17:52:14,286 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:14,286 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql
29/06/2021 17:52:14,286 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	DROP INDEX IF EXISTS puzoneid_tripfacts_index;
	DROP INDEX IF EXISTS dozoneid_tripfacts_index;
	DROP INDEX IF EXISTS pickuptimeid_tripfacts_index;
	DROP INDEX IF EXISTS dropofftimeid_tripfacts_index;
	DROP INDEX IF EXISTS vendorid_tripfacts_index;
	DROP INDEX IF EXISTS is_payment_tripfacts_index;
	DROP INDEX IF EXISTS payment_typeid_tripfacts_index;
	DROP INDEX IF EXISTS ratecodeid_tripfacts_index;
		
	INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now;

	COMMIT;

	CREATE INDEX IF NOT EXISTS puzoneid_tripfacts_index ON business_vault.tripfacts(puzoneid);
	CREATE INDEX IF NOT EXISTS dozoneid_tripfacts_index ON business_vault.tripfacts(dozoneid);
	CREATE INDEX IF NOT EXISTS pickuptimeid_tripfacts_index ON business_vault.tripfacts(pickuptimeid);
	CREATE INDEX IF NOT EXISTS dropofftimeid_tripfacts_index ON business_vault.tripfacts(dropofftimeid);
	CREATE INDEX IF NOT EXISTS vendorid_tripfacts_index ON business_vault.tripfacts(vendorid);
	CREATE INDEX IF NOT EXISTS is_payment_tripfacts_index ON business_vault.tripfacts(is_payment);
	CREATE INDEX IF NOT EXISTS payment_typeid_tripfacts_index ON business_vault.tripfacts(payment_typeid);
	CREATE INDEX IF NOT EXISTS ratecodeid_tripfacts_index ON business_vault.tripfacts(ratecodeid);

END $$; arguments.
29/06/2021 17:52:15,573 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,573 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	CREATE EXTENSION IF NOT EXISTS pgcrypto;

	DROP INDEX IF EXISTS puzoneid_tripfacts_index;
	DROP INDEX IF EXISTS dozoneid_tripfacts_index;
	DROP INDEX IF EXISTS pickuptimeid_tripfacts_index;
	DROP INDEX IF EXISTS dropofftimeid_tripfacts_index;
	DROP INDEX IF EXISTS vendorid_tripfacts_index;
	DROP INDEX IF EXISTS is_payment_tripfacts_index;
	DROP INDEX IF EXISTS payment_typeid_tripfacts_index;
	DROP INDEX IF EXISTS ratecodeid_tripfacts_index;
		
	INSERT INTO business_vault.tripfacts(
		triphashkey,
		pickuptimeid,
		dropofftimeid,
		puzoneid,
		dozoneid,
		vendorid,
		is_payment,
		payment_typeid,
		ratecodeid,
		passengercount,
		total_amount,
		tip_amount,
		trip_distance,
		trip_time)
			
	SELECT 
		st.triphashkey,
		putime.timeid, 
		dotime.timeid, 
		st.puzoneid, 
		st.dozoneid, 
		st.vendorid,
		st.is_payment,
		st.payment_type, 
		st.ratecodeid, 
		st.passenger_count,
		st.total_amount, 
		st.tip_amount,
		st.trip_distance,
		st.tpep_dropoff_datetime - st.tpep_pickup_datetime
			
	FROM raw_vault.sattrips_csv st 
				JOIN business_vault.timedim putime ON 
					(st.tpep_pickup_datetime >= putime.timestring AND 
					st.tpep_pickup_datetime <= putime.timestring + INTERVAL '59 minutes 59 seconds')
				JOIN business_vault.timedim dotime ON 
					(st.tpep_dropoff_datetime >= dotime.timestring AND 
					st.tpep_dropoff_datetime <= dotime.timestring + INTERVAL '59 minutes 59 seconds')
		
	WHERE st.loadenddate > time_now;

	COMMIT;

	CREATE INDEX IF NOT EXISTS puzoneid_tripfacts_index ON business_vault.tripfacts(puzoneid);
	CREATE INDEX IF NOT EXISTS dozoneid_tripfacts_index ON business_vault.tripfacts(dozoneid);
	CREATE INDEX IF NOT EXISTS pickuptimeid_tripfacts_index ON business_vault.tripfacts(pickuptimeid);
	CREATE INDEX IF NOT EXISTS dropofftimeid_tripfacts_index ON business_vault.tripfacts(dropofftimeid);
	CREATE INDEX IF NOT EXISTS vendorid_tripfacts_index ON business_vault.tripfacts(vendorid);
	CREATE INDEX IF NOT EXISTS is_payment_tripfacts_index ON business_vault.tripfacts(is_payment);
	CREATE INDEX IF NOT EXISTS payment_typeid_tripfacts_index ON business_vault.tripfacts(payment_typeid);
	CREATE INDEX IF NOT EXISTS ratecodeid_tripfacts_index ON business_vault.tripfacts(ratecodeid);

END $$; arguments.
29/06/2021 17:52:15,573 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_1_tripfacts.sql script on database.
29/06/2021 17:52:15,584 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_2_service_zonedim.sql
29/06/2021 17:52:15,584 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql
29/06/2021 17:52:15,584 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,584 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql
29/06/2021 17:52:15,585 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zonedim(
		service_zonename) 
	SELECT DISTINCT 
		TRIM(BOTH FROM LOWER(service_zone)) AS "service_zone"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY
		service_zone ASC;
	
END $$; arguments.
29/06/2021 17:52:15,586 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,587 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zonedim(
		service_zonename) 
	SELECT DISTINCT 
		TRIM(BOTH FROM LOWER(service_zone)) AS "service_zone"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY
		service_zone ASC;
	
END $$; arguments.
29/06/2021 17:52:15,587 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_2_service_zonedim.sql script on database.
29/06/2021 17:52:15,587 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_3_boroughdim.sql
29/06/2021 17:52:15,588 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql
29/06/2021 17:52:15,588 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,588 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql
29/06/2021 17:52:15,588 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.boroughdim(
		boroughname)
	SELECT
		DISTINCT TRIM(BOTH FROM LOWER(borough)) AS "borough"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY 
		borough ASC;
		
END $$; arguments.
29/06/2021 17:52:15,590 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,591 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.boroughdim(
		boroughname)
	SELECT
		DISTINCT TRIM(BOTH FROM LOWER(borough)) AS "borough"
	FROM raw_vault.satzones_csv
	WHERE loadenddate > time_now
	ORDER BY 
		borough ASC;
		
END $$; arguments.
29/06/2021 17:52:15,591 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_3_boroughdim.sql script on database.
29/06/2021 17:52:15,591 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_4_zonedim.sql
29/06/2021 17:52:15,591 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql
29/06/2021 17:52:15,592 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,592 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql
29/06/2021 17:52:15,592 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.zonedim(
		zoneid, 
		boroughid, 
		zonename)
	SELECT DISTINCT 
		zoneid, 
		boroughid,
		TRIM(BOTH FROM LOWER("zone")) AS "zone" 
	FROM raw_vault.satzones_csv
		INNER JOIN business_vault.boroughdim ON borough = boroughname
	WHERE loadenddate > time_now
	ORDER BY 
		zoneid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,595 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,596 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.zonedim(
		zoneid, 
		boroughid, 
		zonename)
	SELECT DISTINCT 
		zoneid, 
		boroughid,
		TRIM(BOTH FROM LOWER("zone")) AS "zone" 
	FROM raw_vault.satzones_csv
		INNER JOIN business_vault.boroughdim ON borough = boroughname
	WHERE loadenddate > time_now
	ORDER BY 
		zoneid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,596 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_4_zonedim.sql script on database.
29/06/2021 17:52:15,596 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:52:15,597 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:52:15,597 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,597 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql
29/06/2021 17:52:15,597 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zone_borough_correspondance(
		service_zoneid, 
		boroughid)
	SELECT DISTINCT 
		service_zoneid,
		boroughid
	FROM raw_vault.satzones_csv 
		INNER JOIN business_vault.boroughdim ON borough = boroughname
		INNER JOIN business_vault.service_zonedim ON service_zonename = service_zone
	WHERE loadenddate > time_now
	ORDER BY 
		service_zoneid ASC, 
		boroughid ASC;

END $$; arguments.
29/06/2021 17:52:15,600 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,600 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.service_zone_borough_correspondance(
		service_zoneid, 
		boroughid)
	SELECT DISTINCT 
		service_zoneid,
		boroughid
	FROM raw_vault.satzones_csv 
		INNER JOIN business_vault.boroughdim ON borough = boroughname
		INNER JOIN business_vault.service_zonedim ON service_zonename = service_zone
	WHERE loadenddate > time_now
	ORDER BY 
		service_zoneid ASC, 
		boroughid ASC;

END $$; arguments.
29/06/2021 17:52:15,601 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_5_service_zone_borough_correspondance.sql script on database.
29/06/2021 17:52:15,601 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_6_ratecodedim.sql
29/06/2021 17:52:15,601 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql
29/06/2021 17:52:15,602 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,602 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql
29/06/2021 17:52:15,602 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.ratecodedim(
		ratecodeid, 
		ratecodename)
	SELECT DISTINCT 
		ratecodeid, 
		TRIM(BOTH FROM LOWER(ratecodename)) AS "ratecodename"
	FROM raw_vault.satratecodeids_csv
	WHERE loadenddate > time_now
	ORDER BY 
		ratecodeid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,603 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,604 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN

	INSERT INTO business_vault.ratecodedim(
		ratecodeid, 
		ratecodename)
	SELECT DISTINCT 
		ratecodeid, 
		TRIM(BOTH FROM LOWER(ratecodename)) AS "ratecodename"
	FROM raw_vault.satratecodeids_csv
	WHERE loadenddate > time_now
	ORDER BY 
		ratecodeid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,604 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_6_ratecodedim.sql script on database.
29/06/2021 17:52:15,604 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_7_vendordim.sql
29/06/2021 17:52:15,605 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql
29/06/2021 17:52:15,605 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,605 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql
29/06/2021 17:52:15,605 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN
	
	INSERT INTO business_vault.vendordim(
		vendorid, 
		vendorname)
	SELECT DISTINCT 
		vendorid, 
		TRIM(BOTH FROM LOWER(vendorname)) AS "vendorname"
	FROM raw_vault.satvendors_csv
	WHERE loadenddate > time_now
	ORDER BY 
		vendorid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,608 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,608 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN
	
	INSERT INTO business_vault.vendordim(
		vendorid, 
		vendorname)
	SELECT DISTINCT 
		vendorid, 
		TRIM(BOTH FROM LOWER(vendorname)) AS "vendorname"
	FROM raw_vault.satvendors_csv
	WHERE loadenddate > time_now
	ORDER BY 
		vendorid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,608 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_7_vendordim.sql script on database.
29/06/2021 17:52:15,609 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/business_vault_load_8_payment_typedim.sql
29/06/2021 17:52:15,609 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql
29/06/2021 17:52:15,609 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,609 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql
29/06/2021 17:52:15,610 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN
			
	INSERT INTO business_vault.payment_typedim(
		payment_typeid, 
		payment_type_name)
	SELECT DISTINCT 
		paymenttypeid,
		TRIM(BOTH FROM LOWER(paymenttypename)) AS "paymenttypename"
	FROM raw_vault.satpaymenttypes_csv
	WHERE loadenddate > time_now
	ORDER BY 
		paymenttypeid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,612 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,613 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
DO $$
DECLARE

	time_now timestamp := CAST('2021-06-29 17:52:13' AS TIMESTAMP);

BEGIN
			
	INSERT INTO business_vault.payment_typedim(
		payment_typeid, 
		payment_type_name)
	SELECT DISTINCT 
		paymenttypeid,
		TRIM(BOTH FROM LOWER(paymenttypename)) AS "paymenttypename"
	FROM raw_vault.satpaymenttypes_csv
	WHERE loadenddate > time_now
	ORDER BY 
		paymenttypeid ASC;
		
END $$; arguments.
29/06/2021 17:52:15,613 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\business_vault_load_8_payment_typedim.sql script on database.
29/06/2021 17:52:15,614 - INFO - [Workflow.py:35] - Running bv_to_infomart flow.
29/06/2021 17:52:15,614 - DEBUG - [Workflow.py:39] - Flow of type : inner_database_flux
29/06/2021 17:52:15,614 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_1st_query.sql
29/06/2021 17:52:15,615 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql
29/06/2021 17:52:15,615 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,615 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql
29/06/2021 17:52:15,615 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_statistics_month_most_trips_per_year AS 
	SELECT 
		puzone.zonename AS "Pickup Zone Name", 
		dozone.zonename AS "Dropoff Zone Name", 
		(SELECT TO_CHAR(
	    	TO_DATE (CAST(EXTRACT(MONTH FROM td.timestring) AS TEXT), 'MM'), 'Month'
	    	)
		) 
		AS "Month Name",
		
		avg(total_amount) AS "Average Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Total Amount",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts)
		AS "1st Quartile Total Amount",
		
		min(total_amount) AS "Minimum Total Amount", 
		max(total_amount) AS "Maximum Total Amount", 
		sum(total_amount) AS "Sum Total Amount",
		count(*) AS "Count", 
		avg(passengercount) AS "Average Passsenger Count", 
		sum(passengercount) AS "Total Number of Passenger",
		sum(trip_distance) AS "Total Trip Distance",
		avg(trip_distance) AS "Average Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "1st Quartile Trip Distance",
		
		min(trip_distance) AS "Minimum Trip Distance", 
		max(trip_distance) AS "Maximum Trip Distance",
		avg(trip_time) AS "Average Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Time",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "Median Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts)
		AS "1st Quartile Trip Time",
		
		min(trip_time) AS "Minimum Trip Time", 
		max(trip_time) AS "Maximum Trip Time", 
		sum(trip_time) AS "Sum Trip Time",
		
		(SELECT 
			rcd.ratecodename
		FROM business_vault.tripfacts tf 
			JOIN business_vault.ratecodedim rcd ON tf.ratecodeid = rcd.ratecodeid
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			rcd.ratecodeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Rate",
		
		(SELECT 
			ptd.payment_type_name 
		FROM business_vault.tripfacts tf 
			JOIN business_vault.payment_typedim ptd ON tf.ratecodeid = ptd.payment_typeid 
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			ptd.payment_typeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Payment Method"
		
	FROM business_vault.tripfacts JOIN business_vault.zonedim puzone ON puzoneid = puzone.zoneid
		JOIN business_vault.zonedim dozone ON dozoneid = dozone.zoneid
		JOIN business_vault.timedim td ON td.timeid = pickuptimeid
	WHERE 
		EXTRACT(MONTH FROM td.timestring) = (
			SELECT 
				EXTRACT(MONTH FROM td2.timestring) AS "Month"
			FROM business_vault.tripfacts tf2 
				JOIN business_vault.timedim td2 ON td2.timeid = tf2.pickuptimeid
			GROUP BY 
				EXTRACT(MONTH FROM td2.timestring) 
			ORDER BY 
				count(*) DESC 
			LIMIT 1)
	GROUP BY 
		puzone.zonename,
		dozone.zonename,
		"Month Name"
	ORDER BY 
		count(*) DESC; arguments.
29/06/2021 17:52:15,664 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,665 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_statistics_month_most_trips_per_year AS 
	SELECT 
		puzone.zonename AS "Pickup Zone Name", 
		dozone.zonename AS "Dropoff Zone Name", 
		(SELECT TO_CHAR(
	    	TO_DATE (CAST(EXTRACT(MONTH FROM td.timestring) AS TEXT), 'MM'), 'Month'
	    	)
		) 
		AS "Month Name",
		
		avg(total_amount) AS "Average Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Total Amount",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Total Amount",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts)
		AS "1st Quartile Total Amount",
		
		min(total_amount) AS "Minimum Total Amount", 
		max(total_amount) AS "Maximum Total Amount", 
		sum(total_amount) AS "Sum Total Amount",
		count(*) AS "Count", 
		avg(passengercount) AS "Average Passsenger Count", 
		sum(passengercount) AS "Total Number of Passenger",
		sum(trip_distance) AS "Total Trip Distance",
		avg(trip_distance) AS "Average Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "Median Trip Distance",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY total_amount)
		FROM business_vault.tripfacts) 
		AS "1st Quartile Trip Distance",
		
		min(trip_distance) AS "Minimum Trip Distance", 
		max(trip_distance) AS "Maximum Trip Distance",
		avg(trip_time) AS "Average Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.75) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "3rd Quartile Trip Time",
		(SELECT 
			PERCENTILE_CONT(0.5) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts) 
		AS "Median Trip Time",
		
		(SELECT 
			PERCENTILE_CONT(0.25) 
		WITHIN GROUP 
			(ORDER BY trip_time)
		FROM business_vault.tripfacts)
		AS "1st Quartile Trip Time",
		
		min(trip_time) AS "Minimum Trip Time", 
		max(trip_time) AS "Maximum Trip Time", 
		sum(trip_time) AS "Sum Trip Time",
		
		(SELECT 
			rcd.ratecodename
		FROM business_vault.tripfacts tf 
			JOIN business_vault.ratecodedim rcd ON tf.ratecodeid = rcd.ratecodeid
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			rcd.ratecodeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Rate",
		
		(SELECT 
			ptd.payment_type_name 
		FROM business_vault.tripfacts tf 
			JOIN business_vault.payment_typedim ptd ON tf.ratecodeid = ptd.payment_typeid 
			JOIN business_vault.timedim td ON td.timeid = tf.pickuptimeid
		GROUP BY 
			ptd.payment_typeid, 
			EXTRACT(MONTH FROM td.timestring), 
			EXTRACT(YEAR FROM td.timestring) 
		ORDER BY 
			count(*) DESC 
		LIMIT 1) 
		AS "Most Common Payment Method"
		
	FROM business_vault.tripfacts JOIN business_vault.zonedim puzone ON puzoneid = puzone.zoneid
		JOIN business_vault.zonedim dozone ON dozoneid = dozone.zoneid
		JOIN business_vault.timedim td ON td.timeid = pickuptimeid
	WHERE 
		EXTRACT(MONTH FROM td.timestring) = (
			SELECT 
				EXTRACT(MONTH FROM td2.timestring) AS "Month"
			FROM business_vault.tripfacts tf2 
				JOIN business_vault.timedim td2 ON td2.timeid = tf2.pickuptimeid
			GROUP BY 
				EXTRACT(MONTH FROM td2.timestring) 
			ORDER BY 
				count(*) DESC 
			LIMIT 1)
	GROUP BY 
		puzone.zonename,
		dozone.zonename,
		"Month Name"
	ORDER BY 
		count(*) DESC; arguments.
29/06/2021 17:52:15,665 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_1st_query.sql script on database.
29/06/2021 17:52:15,665 - DEBUG - [FolderStructure.py:150] - Starting FolderStructure.get_file on sql_scripts/information_mart_2nd_query.sql
29/06/2021 17:52:15,665 - DEBUG - [FolderStructure.py:90] - FolderStructure.check_for_file started on C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql
29/06/2021 17:52:15,666 - DEBUG - [FolderStructure.py:94] - FolderStructure.check_for_file ended with <FolderStructure.FolderStructure object at 0x01DE09E8>, True
29/06/2021 17:52:15,666 - DEBUG - [FolderStructure.py:156] - Ending FolderStructure.get_file returning C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql
29/06/2021 17:52:15,666 - DEBUG - [PostgreDBServer.py:34] - PostgreDBServer.execSQL starting with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_frequency_hour_of_day AS 
	SELECT 
		zdpu.zonename AS "Pickup Zone Name", 
		zddo.zonename AS "Dropoff Zone Name",
		q."tot_am_sum" AS "Total Amount Sum", 
		td2."hour" AS "Hour", 
		q."ct" AS "Count"
		
	FROM (
		SELECT DISTINCT 
			"hour" 
		FROM business_vault.timedim) AS td2 
		JOIN LATERAL (
			SELECT 
				tf.puzoneid, 
				tf.dozoneid, 
				sum(tf.total_amount) AS "tot_am_sum", 
				td1."hour", 
				count(*) AS "ct"
			FROM business_vault.tripfacts tf JOIN business_vault.timedim td1 ON tf.pickuptimeid = td1.timeid 
			WHERE 
				--tf.puzoneid != 264 AND tf.dozoneid != 264 AND 
				td1."hour" = td2."hour"
			GROUP BY 
				td1."hour", 
				tf.puzoneid, 
				tf.dozoneid 
			ORDER BY 
				count(*) DESC 
			LIMIT 10
		) AS q ON TRUE
		JOIN business_vault.zonedim zdpu ON zdpu.zoneid = q.puzoneid
		JOIN business_vault.zonedim zddo ON zddo.zoneid = q.dozoneid
	ORDER BY 
		td2."hour" ASC, 
		q."ct" DESC;










 arguments.
29/06/2021 17:52:15,682 - INFO - [PostgreDBServer.py:38] - Executed query on <class 'PostgreDBServer.PostgreDBServer'> type, YellowTaxiTrips database.
29/06/2021 17:52:15,682 - DEBUG - [PostgreDBServer.py:83] - PostgreDBServer.execSQL ended with <PostgreDBServer.PostgreDBServer object at 0x0146E748>, -- CONNECTION: name=postgres
CREATE TABLE information_mart.trips_frequency_hour_of_day AS 
	SELECT 
		zdpu.zonename AS "Pickup Zone Name", 
		zddo.zonename AS "Dropoff Zone Name",
		q."tot_am_sum" AS "Total Amount Sum", 
		td2."hour" AS "Hour", 
		q."ct" AS "Count"
		
	FROM (
		SELECT DISTINCT 
			"hour" 
		FROM business_vault.timedim) AS td2 
		JOIN LATERAL (
			SELECT 
				tf.puzoneid, 
				tf.dozoneid, 
				sum(tf.total_amount) AS "tot_am_sum", 
				td1."hour", 
				count(*) AS "ct"
			FROM business_vault.tripfacts tf JOIN business_vault.timedim td1 ON tf.pickuptimeid = td1.timeid 
			WHERE 
				--tf.puzoneid != 264 AND tf.dozoneid != 264 AND 
				td1."hour" = td2."hour"
			GROUP BY 
				td1."hour", 
				tf.puzoneid, 
				tf.dozoneid 
			ORDER BY 
				count(*) DESC 
			LIMIT 10
		) AS q ON TRUE
		JOIN business_vault.zonedim zdpu ON zdpu.zoneid = q.puzoneid
		JOIN business_vault.zonedim zddo ON zddo.zoneid = q.dozoneid
	ORDER BY 
		td2."hour" ASC, 
		q."ct" DESC;










 arguments.
29/06/2021 17:52:15,683 - INFO - [Workflow.py:111] - Run C:\Users\GGRIPON\Documents\Python_Programs\PostGreTaxi\Model2\sql_scripts\information_mart_2nd_query.sql script on database.
29/06/2021 17:52:15,683 - DEBUG - [PostgreDBServer.py:192] - PostgreDBServer.closeConn run on instance <PostgreDBServer.PostgreDBServer object at 0x0146E748>.
29/06/2021 17:52:15,683 - DEBUG - [PostgreDBServer.py:194] - <connection object at 0x01D704E8; dsn: 'user=postgres password=xxx dbname=YellowTaxiTrips host=localhost port=5432', closed: 1> connection closed.
